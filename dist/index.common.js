"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.VXETablePluginCharts = void 0;

var _xeUtils = _interopRequireDefault(require("xe-utils/methods/xe-utils"));

var echarts = _interopRequireWildcard(require("echarts/lib/echarts"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function createChartModal(getOptions) {
  return function (params) {
    var menu = params.menu;
    this.$XModal({
      resize: true,
      mask: false,
      lockView: false,
      showFooter: false,
      width: 600,
      height: 400,
      title: menu.name,
      slots: {
        "default": function _default(params, h) {
          return [h('div', {
            "class": 'vxe-chart--wrapper'
          }, [h('div', {
            "class": 'vxe-chart--panel'
          })])];
        }
      },
      events: {
        show: function show() {
          var $chart = echarts.init(this.$el.querySelector('.vxe-chart--wrapper'));
          $chart.setOption(getOptions(params));
          this.$chart = $chart;
        },
        close: function close() {
          // 旧版本，即将废弃
          this.$chart.dispose();
          this.$chart = null;
        },
        hide: function hide() {
          this.$chart.dispose();
          this.$chart = null;
        },
        zoom: function zoom() {
          this.$chart.resize();
        }
      }
    });
  };
}

var menuMap = {
  CHART_BAR_X_AXIS: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _ref = $table.getSelectedRanges ? $table.getSelectedRanges() : $table.getMouseCheckeds(),
        rows = _ref.rows,
        columns = _ref.columns;

    var _menu$params = menu.params,
        chartParams = _menu$params === void 0 ? {} : _menu$params;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var legendOpts = {
      data: []
    };
    var seriesOpts = [];
    var xAxisOpts = {
      type: 'category',
      data: rows.map(function (row) {
        return _xeUtils["default"].get(row, categoryColumn.property);
      })
    };
    serieColumns.forEach(function (column) {
      legendOpts.data.push(column.title);
      seriesOpts.push({
        name: column.title,
        type: 'bar',
        data: rows.map(function (row) {
          return _xeUtils["default"].get(row, column.property);
        })
      });
    });
    var option = {
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'shadow'
        }
      },
      legend: legendOpts,
      xAxis: xAxisOpts,
      yAxis: {
        type: 'value'
      },
      series: seriesOpts
    };
    return option;
  }),
  CHART_BAR_Y_AXIS: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _ref2 = $table.getSelectedRanges ? $table.getSelectedRanges() : $table.getMouseCheckeds(),
        rows = _ref2.rows,
        columns = _ref2.columns;

    var _menu$params2 = menu.params,
        chartParams = _menu$params2 === void 0 ? {} : _menu$params2;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var legendOpts = {
      data: []
    };
    var seriesOpts = [];
    var xAxisOpts = {
      type: 'category',
      data: rows.map(function (row) {
        return _xeUtils["default"].get(row, categoryColumn.property);
      })
    };
    serieColumns.forEach(function (column) {
      legendOpts.data.push(column.title);
      seriesOpts.push({
        name: column.title,
        type: 'bar',
        data: rows.map(function (row) {
          return _xeUtils["default"].get(row, column.property);
        })
      });
    });
    var option = {
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'shadow'
        }
      },
      legend: legendOpts,
      xAxis: xAxisOpts,
      yAxis: {
        type: 'value'
      },
      series: seriesOpts
    };
    return option;
  }),
  CHART_LINE: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _ref3 = $table.getSelectedRanges ? $table.getSelectedRanges() : $table.getMouseCheckeds(),
        rows = _ref3.rows,
        columns = _ref3.columns;

    var _menu$params3 = menu.params,
        chartParams = _menu$params3 === void 0 ? {} : _menu$params3;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var legendOpts = {
      data: []
    };
    var seriesOpts = [];
    var xAxisOpts = {
      type: 'category',
      data: rows.map(function (row) {
        return _xeUtils["default"].get(row, categoryColumn.property);
      })
    };
    serieColumns.forEach(function (column) {
      legendOpts.data.push(column.title);
      seriesOpts.push({
        name: column.title,
        type: 'line',
        data: rows.map(function (row) {
          return _xeUtils["default"].get(row, column.property);
        })
      });
    });
    var option = {
      tooltip: {
        trigger: 'axis'
      },
      legend: legendOpts,
      toolbox: {
        feature: {
          saveAsImage: {}
        }
      },
      xAxis: xAxisOpts,
      yAxis: {
        type: 'value'
      },
      series: seriesOpts
    };
    return option;
  }),
  CHART_PIE: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _ref4 = $table.getSelectedRanges ? $table.getSelectedRanges() : $table.getMouseCheckeds(),
        rows = _ref4.rows,
        columns = _ref4.columns;

    var _menu$params4 = menu.params,
        chartParams = _menu$params4 === void 0 ? {} : _menu$params4;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var serieColumn = serieColumns[0];
    var legendData = rows.map(function (row) {
      return _xeUtils["default"].get(row, categoryColumn.property);
    });
    var seriesData = [];
    rows.forEach(function (row) {
      seriesData.push({
        name: _xeUtils["default"].get(row, categoryColumn.property),
        value: _xeUtils["default"].get(row, serieColumn.property)
      });
    });
    var option = {
      tooltip: {
        trigger: 'item',
        formatter: '{a} <br/>{b} : {c} ({d}%)'
      },
      legend: {
        type: 'scroll',
        orient: 'vertical',
        right: 10,
        top: 20,
        bottom: 20,
        data: legendData // selected: data.selected

      },
      series: [{
        name: serieColumn.title,
        type: 'pie',
        radius: '50%',
        center: ['40%', '50%'],
        data: seriesData
      }]
    };
    return option;
  })
};

function checkPrivilege(item, params) {
  var $table = params.$table;
  var code = item.code,
      _item$params = item.params,
      chartParams = _item$params === void 0 ? {} : _item$params;

  switch (code) {
    case 'CHART_BAR_X_AXIS':
    case 'CHART_BAR_Y_AXIS':
    case 'CHART_LINE':
      {
        var _ref5 = $table.getSelectedRanges ? $table.getSelectedRanges() : $table.getMouseCheckeds(),
            rows = _ref5.rows,
            columns = _ref5.columns;

        var category = chartParams.category;

        if (category) {
          var serieColumns = columns.filter(function (column) {
            return column.property !== category;
          });
          item.disabled = !rows.length || serieColumns.length < 1;
        } else {
          item.disabled = !rows.length || columns.length < 2;
        }
      }
      break;

    case 'CHART_PIE':
      {
        var _ref6 = $table.getSelectedRanges ? $table.getSelectedRanges() : $table.getMouseCheckeds(),
            _rows = _ref6.rows,
            _columns = _ref6.columns;

        var _category = chartParams.category;

        if (_category) {
          var _serieColumns = _columns.filter(function (column) {
            return column.property !== _category;
          });

          item.disabled = !_rows.length || _serieColumns.length !== 1;
        } else {
          item.disabled = !_rows.length || _columns.length !== 2;
        }
      }
      break;
  }
}

function handlePrivilegeEvent(params) {
  params.options.forEach(function (list) {
    list.forEach(function (item) {
      checkPrivilege(item, params);

      if (item.children) {
        item.children.forEach(function (child) {
          checkPrivilege(child, params);
        });
      }
    });
  });
}
/**
 * 基于 vxe-table 表格的图表渲染插件
 */


var VXETablePluginCharts = {
  install: function install(xtable) {
    var interceptor = xtable.interceptor,
        menus = xtable.menus,
        _modal = xtable._modal;

    if (!_modal) {
      throw new Error('[vxe-table-plugin-charts] require Modal module.');
    }

    interceptor.add('event.showMenu', handlePrivilegeEvent);
    menus.mixin(menuMap);
  }
};
exports.VXETablePluginCharts = VXETablePluginCharts;

if (typeof window !== 'undefined' && window.VXETable) {
  window.VXETable.use(VXETablePluginCharts);
}

var _default2 = VXETablePluginCharts;
exports["default"] = _default2;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbImNyZWF0ZUNoYXJ0TW9kYWwiLCJnZXRPcHRpb25zIiwicGFyYW1zIiwibWVudSIsIiRYTW9kYWwiLCJyZXNpemUiLCJtYXNrIiwibG9ja1ZpZXciLCJzaG93Rm9vdGVyIiwid2lkdGgiLCJoZWlnaHQiLCJ0aXRsZSIsIm5hbWUiLCJzbG90cyIsImgiLCJldmVudHMiLCJzaG93IiwiJGNoYXJ0IiwiZWNoYXJ0cyIsImluaXQiLCIkZWwiLCJxdWVyeVNlbGVjdG9yIiwic2V0T3B0aW9uIiwiY2xvc2UiLCJkaXNwb3NlIiwiaGlkZSIsInpvb20iLCJtZW51TWFwIiwiQ0hBUlRfQkFSX1hfQVhJUyIsIiR0YWJsZSIsImdldFNlbGVjdGVkUmFuZ2VzIiwiZ2V0TW91c2VDaGVja2VkcyIsInJvd3MiLCJjb2x1bW5zIiwiY2hhcnRQYXJhbXMiLCJjYXRlZ29yeSIsImNhdGVnb3J5Q29sdW1uIiwiZ2V0Q29sdW1uQnlGaWVsZCIsInByb3BlcnR5Iiwic2VyaWVDb2x1bW5zIiwiZmlsdGVyIiwiY29sdW1uIiwibGVnZW5kT3B0cyIsImRhdGEiLCJzZXJpZXNPcHRzIiwieEF4aXNPcHRzIiwidHlwZSIsIm1hcCIsInJvdyIsIlhFVXRpbHMiLCJnZXQiLCJmb3JFYWNoIiwicHVzaCIsIm9wdGlvbiIsInRvb2x0aXAiLCJ0cmlnZ2VyIiwiYXhpc1BvaW50ZXIiLCJsZWdlbmQiLCJ4QXhpcyIsInlBeGlzIiwic2VyaWVzIiwiQ0hBUlRfQkFSX1lfQVhJUyIsIkNIQVJUX0xJTkUiLCJ0b29sYm94IiwiZmVhdHVyZSIsInNhdmVBc0ltYWdlIiwiQ0hBUlRfUElFIiwic2VyaWVDb2x1bW4iLCJsZWdlbmREYXRhIiwic2VyaWVzRGF0YSIsInZhbHVlIiwiZm9ybWF0dGVyIiwib3JpZW50IiwicmlnaHQiLCJ0b3AiLCJib3R0b20iLCJyYWRpdXMiLCJjZW50ZXIiLCJjaGVja1ByaXZpbGVnZSIsIml0ZW0iLCJjb2RlIiwiZGlzYWJsZWQiLCJsZW5ndGgiLCJoYW5kbGVQcml2aWxlZ2VFdmVudCIsIm9wdGlvbnMiLCJsaXN0IiwiY2hpbGRyZW4iLCJjaGlsZCIsIlZYRVRhYmxlUGx1Z2luQ2hhcnRzIiwiaW5zdGFsbCIsInh0YWJsZSIsImludGVyY2VwdG9yIiwibWVudXMiLCJfbW9kYWwiLCJFcnJvciIsImFkZCIsIm1peGluIiwid2luZG93IiwiVlhFVGFibGUiLCJ1c2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUVBOzs7Ozs7OztBQUVBLFNBQVNBLGdCQUFULENBQTJCQyxVQUEzQixFQUEwQztBQUN4QyxTQUFPLFVBQXFCQyxNQUFyQixFQUFnQztBQUFBLFFBQy9CQyxJQUQrQixHQUN0QkQsTUFEc0IsQ0FDL0JDLElBRCtCO0FBRXJDLFNBQUtDLE9BQUwsQ0FBYTtBQUNYQyxNQUFBQSxNQUFNLEVBQUUsSUFERztBQUVYQyxNQUFBQSxJQUFJLEVBQUUsS0FGSztBQUdYQyxNQUFBQSxRQUFRLEVBQUUsS0FIQztBQUlYQyxNQUFBQSxVQUFVLEVBQUUsS0FKRDtBQUtYQyxNQUFBQSxLQUFLLEVBQUUsR0FMSTtBQU1YQyxNQUFBQSxNQUFNLEVBQUUsR0FORztBQU9YQyxNQUFBQSxLQUFLLEVBQUVSLElBQUksQ0FBQ1MsSUFQRDtBQVFYQyxNQUFBQSxLQUFLLEVBQUU7QUFBQSxxQ0FDSVgsTUFESixFQUNpQlksQ0FEakIsRUFDNEI7QUFDL0IsaUJBQU8sQ0FDTEEsQ0FBQyxDQUFDLEtBQUQsRUFBUTtBQUNQLHFCQUFPO0FBREEsV0FBUixFQUVFLENBQ0RBLENBQUMsQ0FBQyxLQUFELEVBQVE7QUFDUCxxQkFBTztBQURBLFdBQVIsQ0FEQSxDQUZGLENBREksQ0FBUDtBQVNEO0FBWEksT0FSSTtBQXFCWEMsTUFBQUEsTUFBTSxFQUFFO0FBQ05DLFFBQUFBLElBRE0sa0JBQ0Y7QUFDRixjQUFNQyxNQUFNLEdBQUdDLE9BQU8sQ0FBQ0MsSUFBUixDQUFhLEtBQUtDLEdBQUwsQ0FBU0MsYUFBVCxDQUF1QixxQkFBdkIsQ0FBYixDQUFmO0FB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Q0MsUUFBNUMsRUFBc0Q7QUFDcERELEVBQUFBLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsR0FBaEIsQ0FBb0JYLG9CQUFwQjtBQUNEOztnQkFFY0Esb0IiLCJmaWxlIjoiaW5kZXguY29tbW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFhFVXRpbHMgZnJvbSAneGUtdXRpbHMvbWV0aG9kcy94ZS11dGlscydcclxuaW1wb3J0IFZYRVRhYmxlIGZyb20gJ3Z4ZS10YWJsZS9saWIvdnhlLXRhYmxlJ1xyXG5pbXBvcnQgKiBhcyBlY2hhcnRzIGZyb20gJ2VjaGFydHMvbGliL2VjaGFydHMnXHJcblxyXG5mdW5jdGlvbiBjcmVhdGVDaGFydE1vZGFsIChnZXRPcHRpb25zOiBhbnkpIHtcclxuICByZXR1cm4gZnVuY3Rpb24gKHRoaXM6IGFueSwgcGFyYW1zOiBhbnkpIHtcclxuICAgIGxldCB7IG1lbnUgfSA9IHBhcmFtc1xyXG4gICAgdGhpcy4kWE1vZGFsKHtcclxuICAgICAgcmVzaXplOiB0cnVlLFxyXG4gICAgICBtYXNrOiBmYWxzZSxcclxuICAgICAgbG9ja1ZpZXc6IGZhbHNlLFxyXG4gICAgICBzaG93Rm9vdGVyOiBmYWxzZSxcclxuICAgICAgd2lkdGg6IDYwMCxcclxuICAgICAgaGVpZ2h0OiA0MDAsXHJcbiAgICAgIHRpdGxlOiBtZW51Lm5hbWUsXHJcbiAgICAgIHNsb3RzOiB7XHJcbiAgICAgICAgZGVmYXVsdCAocGFyYW1zOiBhbnksIGg6IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICBoKCdkaXYnLCB7XHJcbiAgICAgICAgICAgICAgY2xhc3M6ICd2eGUtY2hhcnQtLXdyYXBwZXInXHJcbiAgICAgICAgICAgIH0sIFtcclxuICAgICAgICAgICAgICBoKCdkaXYnLCB7XHJcbiAgICAgICAgICAgICAgICBjbGFzczogJ3Z4ZS1jaGFydC0tcGFuZWwnXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgXSlcclxuICAgICAgICAgIF1cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGV2ZW50czoge1xyXG4gICAgICAgIHNob3cgKHRoaXM6IGFueSkge1xyXG4gICAgICAgICAgY29uc3QgJGNoYXJ0ID0gZWNoYXJ0cy5pbml0KHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoJy52eGUtY2hhcnQtLXdyYXBwZXInKSlcclxuICAgICAgICAgICRjaGFydC5zZXRPcHRpb24oZ2V0T3B0aW9ucyhwYXJhbXMpKVxyXG4gICAgICAgICAgdGhpcy4kY2hhcnQgPSAkY2hhcnRcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNsb3NlICh0aGlzOiBhbnkpIHtcclxuICAgICAgICAgIC8vIOaXp+eJiOacrO+8jOWNs+WwhuW6n+W8g1xyXG4gICAgICAgICAgdGhpcy4kY2hhcnQuZGlzcG9zZSgpXHJcbiAgICAgICAgICB0aGlzLiRjaGFydCA9IG51bGxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGhpZGUgKHRoaXM6IGFueSkge1xyXG4gICAgICAgICAgdGhpcy4kY2hhcnQuZGlzcG9zZSgpXHJcbiAgICAgICAgICB0aGlzLiRjaGFydCA9IG51bGxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHpvb20gKHRoaXM6IGFueSkge1xyXG4gICAgICAgICAgdGhpcy4kY2hhcnQucmVzaXplKClcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG59XHJcblxyXG5pbnRlcmZhY2UgbGVnZW5kT3B0cyB7XHJcbiAgZGF0YTogQXJyYXk8YW55PjtcclxufVxyXG5cclxuY29uc3QgbWVudU1hcCA9IHtcclxuICBDSEFSVF9CQVJfWF9BWElTOiBjcmVhdGVDaGFydE1vZGFsKChwYXJhbXM6IGFueSkgPT4ge1xyXG4gICAgY29uc3QgeyAkdGFibGUsIG1lbnUgfSA9IHBhcmFtc1xyXG4gICAgY29uc3QgeyByb3dzLCBjb2x1bW5zIH0gPSAkdGFibGUuZ2V0U2VsZWN0ZWRSYW5nZXMgPyAkdGFibGUuZ2V0U2VsZWN0ZWRSYW5nZXMoKSA6ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKClcclxuICAgIGNvbnN0IHsgcGFyYW1zOiBjaGFydFBhcmFtcyA9IHt9IH0gPSBtZW51XHJcbiAgICBjb25zdCB7IGNhdGVnb3J5IH0gPSBjaGFydFBhcmFtc1xyXG4gICAgbGV0IGNhdGVnb3J5Q29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5RmllbGQoY2F0ZWdvcnkgfHwgY29sdW1uc1swXS5wcm9wZXJ0eSlcclxuICAgIGxldCBzZXJpZUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpXHJcbiAgICBsZXQgbGVnZW5kT3B0czogbGVnZW5kT3B0cyA9IHtcclxuICAgICAgZGF0YTogW11cclxuICAgIH1cclxuICAgIGxldCBzZXJpZXNPcHRzOiBBcnJheTxhbnk+ID0gW11cclxuICAgIGxldCB4QXhpc09wdHMgPSB7XHJcbiAgICAgIHR5cGU6ICdjYXRlZ29yeScsXHJcbiAgICAgIGRhdGE6IHJvd3MubWFwKChyb3c6IGFueSkgPT4gWEVVdGlscy5nZXQocm93LCBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eSkpXHJcbiAgICB9XHJcbiAgICBzZXJpZUNvbHVtbnMuZm9yRWFjaCgoY29sdW1uOiBhbnkpID0+IHtcclxuICAgICAgbGVnZW5kT3B0cy5kYXRhLnB1c2goY29sdW1uLnRpdGxlKVxyXG4gICAgICBzZXJpZXNPcHRzLnB1c2goe1xyXG4gICAgICAgIG5hbWU6IGNvbHVtbi50aXRsZSxcclxuICAgICAgICB0eXBlOiAnYmFyJyxcclxuICAgICAgICBkYXRhOiByb3dzLm1hcCgocm93OiBhbnkpID0+IFhFVXRpbHMuZ2V0KHJvdywgY29sdW1uLnByb3BlcnR5KSlcclxuICAgICAgfSlcclxuICAgIH0pXHJcbiAgICBjb25zdCBvcHRpb24gPSB7XHJcbiAgICAgIHRvb2x0aXA6IHtcclxuICAgICAgICB0cmlnZ2VyOiAnYXhpcycsXHJcbiAgICAgICAgYXhpc1BvaW50ZXI6IHtcclxuICAgICAgICAgIHR5cGU6ICdzaGFkb3cnXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBsZWdlbmQ6IGxlZ2VuZE9wdHMsXHJcbiAgICAgIHhBeGlzOiB4QXhpc09wdHMsXHJcbiAgICAgIHlBeGlzOiB7XHJcbiAgICAgICAgdHlwZTogJ3ZhbHVlJ1xyXG4gICAgICB9LFxyXG4gICAgICBzZXJpZXM6IHNlcmllc09wdHNcclxuICAgIH1cclxuICAgIHJldHVybiBvcHRpb25cclxuICB9KSxcclxuICBDSEFSVF9CQVJfWV9BWElTOiBjcmVhdGVDaGFydE1vZGFsKChwYXJhbXM6IGFueSkgPT4ge1xyXG4gICAgY29uc3QgeyAkdGFibGUsIG1lbnUgfSA9IHBhcmFtc1xyXG4gICAgY29uc3QgeyByb3dzLCBjb2x1bW5zIH0gPSAkdGFibGUuZ2V0U2VsZWN0ZWRSYW5nZXMgPyAkdGFibGUuZ2V0U2VsZWN0ZWRSYW5nZXMoKSA6ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKClcclxuICAgIGNvbnN0IHsgcGFyYW1zOiBjaGFydFBhcmFtcyA9IHt9IH0gPSBtZW51XHJcbiAgICBjb25zdCB7IGNhdGVnb3J5IH0gPSBjaGFydFBhcmFtc1xyXG4gICAgbGV0IGNhdGVnb3J5Q29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5RmllbGQoY2F0ZWdvcnkgfHwgY29sdW1uc1swXS5wcm9wZXJ0eSlcclxuICAgIGxldCBzZXJpZUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpXHJcbiAgICBsZXQgbGVnZW5kT3B0czogbGVnZW5kT3B0cyA9IHtcclxuICAgICAgZGF0YTogW11cclxuICAgIH1cclxuICAgIGxldCBzZXJpZXNPcHRzOiBBcnJheTxhbnk+ID0gW11cclxuICAgIGxldCB4QXhpc09wdHMgPSB7XHJcbiAgICAgIHR5cGU6ICdjYXRlZ29yeScsXHJcbiAgICAgIGRhdGE6IHJvd3MubWFwKChyb3c6IGFueSkgPT4gWEVVdGlscy5nZXQocm93LCBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eSkpXHJcbiAgICB9XHJcbiAgICBzZXJpZUNvbHVtbnMuZm9yRWFjaCgoY29sdW1uOiBhbnkpID0+IHtcclxuICAgICAgbGVnZW5kT3B0cy5kYXRhLnB1c2goY29sdW1uLnRpdGxlKVxyXG4gICAgICBzZXJpZXNPcHRzLnB1c2goe1xyXG4gICAgICAgIG5hbWU6IGNvbHVtbi50aXRsZSxcclxuICAgICAgICB0eXBlOiAnYmFyJyxcclxuICAgICAgICBkYXRhOiByb3dzLm1hcCgocm93OiBhbnkpID0+IFhFVXRpbHMuZ2V0KHJvdywgY29sdW1uLnByb3BlcnR5KSlcclxuICAgICAgfSlcclxuICAgIH0pXHJcbiAgICBjb25zdCBvcHRpb24gPSB7XHJcbiAgICAgIHRvb2x0aXA6IHtcclxuICAgICAgICB0cmlnZ2VyOiAnYXhpcycsXHJcbiAgICAgICAgYXhpc1BvaW50ZXI6IHtcclxuICAgICAgICAgIHR5cGU6ICdzaGFkb3cnXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBsZWdlbmQ6IGxlZ2VuZE9wdHMsXHJcbiAgICAgIHhBeGlzOiB4QXhpc09wdHMsXHJcbiAgICAgIHlBeGlzOiB7XHJcbiAgICAgICAgdHlwZTogJ3ZhbHVlJ1xyXG4gICAgICB9LFxyXG4gICAgICBzZXJpZXM6IHNlcmllc09wdHNcclxuICAgIH1cclxuICAgIHJldHVybiBvcHRpb25cclxuICB9KSxcclxuICBDSEFSVF9MSU5FOiBjcmVhdGVDaGFydE1vZGFsKChwYXJhbXM6IGFueSkgPT4ge1xyXG4gICAgY29uc3QgeyAkdGFibGUsIG1lbnUgfSA9IHBhcmFtc1xyXG4gICAgY29uc3QgeyByb3dzLCBjb2x1bW5zIH0gPSAkdGFibGUuZ2V0U2VsZWN0ZWRSYW5nZXMgPyAkdGFibGUuZ2V0U2VsZWN0ZWRSYW5nZXMoKSA6ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKClcclxuICAgIGNvbnN0IHsgcGFyYW1zOiBjaGFydFBhcmFtcyA9IHt9IH0gPSBtZW51XHJcbiAgICBjb25zdCB7IGNhdGVnb3J5IH0gPSBjaGFydFBhcmFtc1xyXG4gICAgbGV0IGNhdGVnb3J5Q29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5RmllbGQoY2F0ZWdvcnkgfHwgY29sdW1uc1swXS5wcm9wZXJ0eSlcclxuICAgIGxldCBzZXJpZUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpXHJcbiAgICBsZXQgbGVnZW5kT3B0czogbGVnZW5kT3B0cyA9IHtcclxuICAgICAgZGF0YTogW11cclxuICAgIH1cclxuICAgIGxldCBzZXJpZXNPcHRzOiBBcnJheTxhbnk+ID0gW11cclxuICAgIGxldCB4QXhpc09wdHMgPSB7XHJcbiAgICAgIHR5cGU6ICdjYXRlZ29yeScsXHJcbiAgICAgIGRhdGE6IHJvd3MubWFwKChyb3c6IGFueSkgPT4gWEVVdGlscy5nZXQocm93LCBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eSkpXHJcbiAgICB9XHJcbiAgICBzZXJpZUNvbHVtbnMuZm9yRWFjaCgoY29sdW1uOiBhbnkpID0+IHtcclxuICAgICAgbGVnZW5kT3B0cy5kYXRhLnB1c2goY29sdW1uLnRpdGxlKVxyXG4gICAgICBzZXJpZXNPcHRzLnB1c2goe1xyXG4gICAgICAgIG5hbWU6IGNvbHVtbi50aXRsZSxcclxuICAgICAgICB0eXBlOiAnbGluZScsXHJcbiAgICAgICAgZGF0YTogcm93cy5tYXAoKHJvdzogYW55KSA9PiBYRVV0aWxzLmdldChyb3csIGNvbHVtbi5wcm9wZXJ0eSkpXHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gICAgbGV0IG9wdGlvbiA9IHtcclxuICAgICAgdG9vbHRpcDoge1xyXG4gICAgICAgIHRyaWdnZXI6ICdheGlzJ1xyXG4gICAgICB9LFxyXG4gICAgICBsZWdlbmQ6IGxlZ2VuZE9wdHMsXHJcbiAgICAgIHRvb2xib3g6IHtcclxuICAgICAgICBmZWF0dXJlOiB7XHJcbiAgICAgICAgICBzYXZlQXNJbWFnZToge31cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHhBeGlzOiB4QXhpc09wdHMsXHJcbiAgICAgIHlBeGlzOiB7XHJcbiAgICAgICAgdHlwZTogJ3ZhbHVlJ1xyXG4gICAgICB9LFxyXG4gICAgICBzZXJpZXM6IHNlcmllc09wdHNcclxuICAgIH1cclxuICAgIHJldHVybiBvcHRpb25cclxuICB9KSxcclxuICBDSEFSVF9QSUU6IGNyZWF0ZUNoYXJ0TW9kYWwoKHBhcmFtczogYW55KSA9PiB7XHJcbiAgICBjb25zdCB7ICR0YWJsZSwgbWVudSB9ID0gcGFyYW1zXHJcbiAgICBjb25zdCB7IHJvd3MsIGNvbHVtbnMgfSA9ICR0YWJsZS5nZXRTZWxlY3RlZFJhbmdlcyA/ICR0YWJsZS5nZXRTZWxlY3RlZFJhbmdlcygpIDogJHRhYmxlLmdldE1vdXNlQ2hlY2tlZHMoKVxyXG4gICAgY29uc3QgeyBwYXJhbXM6IGNoYXJ0UGFyYW1zID0ge30gfSA9IG1lbnVcclxuICAgIGNvbnN0IHsgY2F0ZWdvcnkgfSA9IGNoYXJ0UGFyYW1zXHJcbiAgICBsZXQgY2F0ZWdvcnlDb2x1bW4gPSAkdGFibGUuZ2V0Q29sdW1uQnlGaWVsZChjYXRlZ29yeSB8fCBjb2x1bW5zWzBdLnByb3BlcnR5KVxyXG4gICAgbGV0IHNlcmllQ29sdW1ucyA9IGNvbHVtbnMuZmlsdGVyKChjb2x1bW46IGFueSkgPT4gY29sdW1uLnByb3BlcnR5ICE9PSBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eSlcclxuICAgIGxldCBzZXJpZUNvbHVtbiA9IHNlcmllQ29sdW1uc1swXVxyXG4gICAgbGV0IGxlZ2VuZERhdGEgPSByb3dzLm1hcCgocm93OiBhbnkpID0+IFhFVXRpbHMuZ2V0KHJvdywgY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpKVxyXG4gICAgbGV0IHNlcmllc0RhdGE6IEFycmF5PGFueT4gPSBbXVxyXG4gICAgcm93cy5mb3JFYWNoKChyb3c6IGFueSkgPT4ge1xyXG4gICAgICBzZXJpZXNEYXRhLnB1c2goe1xyXG4gICAgICAgIG5hbWU6IFhFVXRpbHMuZ2V0KHJvdywgY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpLFxyXG4gICAgICAgIHZhbHVlOiBYRVV0aWxzLmdldChyb3csIHNlcmllQ29sdW1uLnByb3BlcnR5KVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICAgIGxldCBvcHRpb24gPSB7XHJcbiAgICAgIHRvb2x0aXA6IHtcclxuICAgICAgICB0cmlnZ2VyOiAnaXRlbScsXHJcbiAgICAgICAgZm9ybWF0dGVyOiAne2F9IDxici8+e2J9IDoge2N9ICh7ZH0lKSdcclxuICAgICAgfSxcclxuICAgICAgbGVnZW5kOiB7XHJcbiAgICAgICAgdHlwZTogJ3Njcm9sbCcsXHJcbiAgICAgICAgb3JpZW50OiAndmVydGljYWwnLFxyXG4gICAgICAgIHJpZ2h0OiAxMCxcclxuICAgICAgICB0b3A6IDIwLFxyXG4gICAgICAgIGJvdHRvbTogMjAsXHJcbiAgICAgICAgZGF0YTogbGVnZW5kRGF0YVxyXG4gICAgICAgIC8vIHNlbGVjdGVkOiBkYXRhLnNlbGVjdGVkXHJcbiAgICAgIH0sXHJcbiAgICAgIHNlcmllczogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIG5hbWU6IHNlcmllQ29sdW1uLnRpdGxlLFxyXG4gICAgICAgICAgdHlwZTogJ3BpZScsXHJcbiAgICAgICAgICByYWRpdXM6ICc1MCUnLFxyXG4gICAgICAgICAgY2VudGVyOiBbJzQwJScsICc1MCUnXSxcclxuICAgICAgICAgIGRhdGE6IHNlcmllc0RhdGFcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICAgIH1cclxuICAgIHJldHVybiBvcHRpb25cclxuICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBjaGVja1ByaXZpbGVnZSAoaXRlbTogYW55LCBwYXJhbXM6IGFueSkge1xyXG4gIGNvbnN0IHsgJHRhYmxlIH0gPSBwYXJhbXNcclxuICBjb25zdCB7IGNvZGUsIHBhcmFtczogY2hhcnRQYXJhbXMgPSB7fSB9ID0gaXRlbVxyXG4gIHN3aXRjaCAoY29kZSkge1xyXG4gICAgY2FzZSAnQ0hBUlRfQkFSX1hfQVhJUyc6XHJcbiAgICBjYXNlICdDSEFSVF9CQVJfWV9BWElTJzpcclxuICAgIGNhc2UgJ0NIQVJUX0xJTkUnOiB7XHJcbiAgICAgIGNvbnN0IHsgcm93cywgY29sdW1ucyB9ID0gJHRhYmxlLmdldFNlbGVjdGVkUmFuZ2VzID8gJHRhYmxlLmdldFNlbGVjdGVkUmFuZ2VzKCkgOiAkdGFibGUuZ2V0TW91c2VDaGVja2VkcygpXHJcbiAgICAgIGNvbnN0IHsgY2F0ZWdvcnkgfSA9IGNoYXJ0UGFyYW1zXHJcbiAgICAgIGlmIChjYXRlZ29yeSkge1xyXG4gICAgICAgIGxldCBzZXJpZUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnkpXHJcbiAgICAgICAgaXRlbS5kaXNhYmxlZCA9ICFyb3dzLmxlbmd0aCB8fCBzZXJpZUNvbHVtbnMubGVuZ3RoIDwgMVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGl0ZW0uZGlzYWJsZWQgPSAhcm93cy5sZW5ndGggfHwgY29sdW1ucy5sZW5ndGggPCAyXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgICAgYnJlYWtcclxuICAgIGNhc2UgJ0NIQVJUX1BJRSc6IHtcclxuICAgICAgY29uc3QgeyByb3dzLCBjb2x1bW5zIH0gPSAkdGFibGUuZ2V0U2VsZWN0ZWRSYW5nZXMgPyAkdGFibGUuZ2V0U2VsZWN0ZWRSYW5nZXMoKSA6ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKClcclxuICAgICAgY29uc3QgeyBjYXRlZ29yeSB9ID0gY2hhcnRQYXJhbXNcclxuICAgICAgaWYgKGNhdGVnb3J5KSB7XHJcbiAgICAgICAgbGV0IHNlcmllQ29sdW1ucyA9IGNvbHVtbnMuZmlsdGVyKChjb2x1bW46IGFueSkgPT4gY29sdW1uLnByb3BlcnR5ICE9PSBjYXRlZ29yeSlcclxuICAgICAgICBpdGVtLmRpc2FibGVkID0gIXJvd3MubGVuZ3RoIHx8IHNlcmllQ29sdW1ucy5sZW5ndGggIT09IDFcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpdGVtLmRpc2FibGVkID0gIXJvd3MubGVuZ3RoIHx8IGNvbHVtbnMubGVuZ3RoICE9PSAyXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgICAgYnJlYWtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZVByaXZpbGVnZUV2ZW50IChwYXJhbXM6IGFueSkge1xyXG4gIHBhcmFtcy5vcHRpb25zLmZvckVhY2goKGxpc3Q6IEFycmF5PGFueT4pID0+IHtcclxuICAgIGxpc3QuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgIGNoZWNrUHJpdmlsZWdlKGl0ZW0sIHBhcmFtcylcclxuICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4pIHtcclxuICAgICAgICBpdGVtLmNoaWxkcmVuLmZvckVhY2goKGNoaWxkOiBhbnkpID0+IHtcclxuICAgICAgICAgIGNoZWNrUHJpdmlsZWdlKGNoaWxkLCBwYXJhbXMpXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICog5Z+65LqOIHZ4ZS10YWJsZSDooajmoLznmoTlm77ooajmuLLmn5Pmj5Lku7ZcclxuICovXHJcbmV4cG9ydCBjb25zdCBWWEVUYWJsZVBsdWdpbkNoYXJ0cyA9IHtcclxuICBpbnN0YWxsICh4dGFibGU6IHR5cGVvZiBWWEVUYWJsZSkge1xyXG4gICAgbGV0IHsgaW50ZXJjZXB0b3IsIG1lbnVzLCBfbW9kYWwgfSA9IHh0YWJsZVxyXG4gICAgaWYgKCFfbW9kYWwpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdbdnhlLXRhYmxlLXBsdWdpbi1jaGFydHNdIHJlcXVpcmUgTW9kYWwgbW9kdWxlLicpXHJcbiAgICB9XHJcbiAgICBpbnRlcmNlcHRvci5hZGQoJ2V2ZW50LnNob3dNZW51JywgaGFuZGxlUHJpdmlsZWdlRXZlbnQpXHJcbiAgICBtZW51cy5taXhpbihtZW51TWFwKVxyXG4gIH1cclxufVxyXG5cclxuaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5WWEVUYWJsZSkge1xyXG4gIHdpbmRvdy5WWEVUYWJsZS51c2UoVlhFVGFibGVQbHVnaW5DaGFydHMpXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFZYRVRhYmxlUGx1Z2luQ2hhcnRzXHJcbiJdfQ==

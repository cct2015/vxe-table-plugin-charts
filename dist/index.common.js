"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.VXETablePluginCharts = void 0;

var _xeUtils = _interopRequireDefault(require("xe-utils/methods/xe-utils"));

var echarts = _interopRequireWildcard(require("echarts/lib/echarts"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; if (obj != null) { var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function createChartModal(getOptions) {
  return function (params) {
    var menu = params.menu;
    this.$XModal({
      resize: true,
      mask: false,
      lockView: false,
      showFooter: false,
      width: 600,
      height: 400,
      title: menu.name,
      slots: {
        "default": function _default(params, h) {
          return [h('div', {
            "class": 'vxe-chart--wrapper'
          }, [h('div', {
            "class": 'vxe-chart--panel'
          })])];
        }
      },
      events: {
        show: function show() {
          var $chart = echarts.init(this.$el.querySelector('.vxe-chart--wrapper'));
          $chart.setOption(getOptions(params));
          this.$chart = $chart;
        },
        close: function close() {
          // 旧版本，即将废弃
          this.$chart.dispose();
          this.$chart = null;
        },
        hide: function hide() {
          this.$chart.dispose();
          this.$chart = null;
        },
        zoom: function zoom() {
          this.$chart.resize();
        }
      }
    });
  };
}

var menuMap = {
  CHART_BAR_X_AXIS: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _$table$getMouseCheck = $table.getMouseCheckeds(),
        rows = _$table$getMouseCheck.rows,
        columns = _$table$getMouseCheck.columns;

    var _menu$params = menu.params,
        chartParams = _menu$params === void 0 ? {} : _menu$params;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var legendOpts = {
      data: []
    };
    var seriesOpts = [];
    var xAxisOpts = {
      type: 'category',
      data: rows.map(function (row) {
        return _xeUtils["default"].get(row, categoryColumn.property);
      })
    };
    serieColumns.forEach(function (column) {
      legendOpts.data.push(column.title);
      seriesOpts.push({
        name: column.title,
        type: 'bar',
        data: rows.map(function (row) {
          return _xeUtils["default"].get(row, column.property);
        })
      });
    });
    var option = {
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'shadow'
        }
      },
      legend: legendOpts,
      xAxis: xAxisOpts,
      yAxis: {
        type: 'value'
      },
      series: seriesOpts
    };
    return option;
  }),
  CHART_BAR_Y_AXIS: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _$table$getMouseCheck2 = $table.getMouseCheckeds(),
        rows = _$table$getMouseCheck2.rows,
        columns = _$table$getMouseCheck2.columns;

    var _menu$params2 = menu.params,
        chartParams = _menu$params2 === void 0 ? {} : _menu$params2;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var legendOpts = {
      data: []
    };
    var seriesOpts = [];
    var xAxisOpts = {
      type: 'category',
      data: rows.map(function (row) {
        return _xeUtils["default"].get(row, categoryColumn.property);
      })
    };
    serieColumns.forEach(function (column) {
      legendOpts.data.push(column.title);
      seriesOpts.push({
        name: column.title,
        type: 'bar',
        data: rows.map(function (row) {
          return _xeUtils["default"].get(row, column.property);
        })
      });
    });
    var option = {
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'shadow'
        }
      },
      legend: legendOpts,
      xAxis: xAxisOpts,
      yAxis: {
        type: 'value'
      },
      series: seriesOpts
    };
    return option;
  }),
  CHART_LINE: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _$table$getMouseCheck3 = $table.getMouseCheckeds(),
        rows = _$table$getMouseCheck3.rows,
        columns = _$table$getMouseCheck3.columns;

    var _menu$params3 = menu.params,
        chartParams = _menu$params3 === void 0 ? {} : _menu$params3;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var legendOpts = {
      data: []
    };
    var seriesOpts = [];
    var xAxisOpts = {
      type: 'category',
      data: rows.map(function (row) {
        return _xeUtils["default"].get(row, categoryColumn.property);
      })
    };
    serieColumns.forEach(function (column) {
      legendOpts.data.push(column.title);
      seriesOpts.push({
        name: column.title,
        type: 'line',
        data: rows.map(function (row) {
          return _xeUtils["default"].get(row, column.property);
        })
      });
    });
    var option = {
      tooltip: {
        trigger: 'axis'
      },
      legend: legendOpts,
      toolbox: {
        feature: {
          saveAsImage: {}
        }
      },
      xAxis: xAxisOpts,
      yAxis: {
        type: 'value'
      },
      series: seriesOpts
    };
    return option;
  }),
  CHART_PIE: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _$table$getMouseCheck4 = $table.getMouseCheckeds(),
        rows = _$table$getMouseCheck4.rows,
        columns = _$table$getMouseCheck4.columns;

    var _menu$params4 = menu.params,
        chartParams = _menu$params4 === void 0 ? {} : _menu$params4;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var serieColumn = serieColumns[0];
    var legendData = rows.map(function (row) {
      return _xeUtils["default"].get(row, categoryColumn.property);
    });
    var seriesData = [];
    rows.forEach(function (row) {
      seriesData.push({
        name: _xeUtils["default"].get(row, categoryColumn.property),
        value: _xeUtils["default"].get(row, serieColumn.property)
      });
    });
    var option = {
      tooltip: {
        trigger: 'item',
        formatter: '{a} <br/>{b} : {c} ({d}%)'
      },
      legend: {
        type: 'scroll',
        orient: 'vertical',
        right: 10,
        top: 20,
        bottom: 20,
        data: legendData // selected: data.selected

      },
      series: [{
        name: serieColumn.title,
        type: 'pie',
        radius: '50%',
        center: ['40%', '50%'],
        data: seriesData
      }]
    };
    return option;
  })
};

function checkPrivilege(item, params) {
  var $table = params.$table;
  var code = item.code,
      _item$params = item.params,
      chartParams = _item$params === void 0 ? {} : _item$params;

  switch (code) {
    case 'CHART_BAR_X_AXIS':
    case 'CHART_BAR_Y_AXIS':
    case 'CHART_LINE':
      {
        var _$table$getMouseCheck5 = $table.getMouseCheckeds(),
            rows = _$table$getMouseCheck5.rows,
            columns = _$table$getMouseCheck5.columns;

        var category = chartParams.category;

        if (category) {
          var serieColumns = columns.filter(function (column) {
            return column.property !== category;
          });
          item.disabled = !rows.length || serieColumns.length < 1;
        } else {
          item.disabled = !rows.length || columns.length < 2;
        }
      }
      break;

    case 'CHART_PIE':
      {
        var _$table$getMouseCheck6 = $table.getMouseCheckeds(),
            _rows = _$table$getMouseCheck6.rows,
            _columns = _$table$getMouseCheck6.columns;

        var _category = chartParams.category;

        if (_category) {
          var _serieColumns = _columns.filter(function (column) {
            return column.property !== _category;
          });

          item.disabled = !_rows.length || _serieColumns.length !== 1;
        } else {
          item.disabled = !_rows.length || _columns.length !== 2;
        }
      }
      break;
  }
}

function handlePrivilegeEvent(params) {
  params.options.forEach(function (list) {
    list.forEach(function (item) {
      checkPrivilege(item, params);

      if (item.children) {
        item.children.forEach(function (child) {
          checkPrivilege(child, params);
        });
      }
    });
  });
}
/**
 * 基于 vxe-table 表格的图表渲染插件
 */


var VXETablePluginCharts = {
  install: function install(xtable) {
    var interceptor = xtable.interceptor,
        menus = xtable.menus,
        _modal = xtable._modal;

    if (!_modal) {
      throw new Error('[vxe-table-plugin-charts] require Modal module.');
    }

    interceptor.add('event.showMenu', handlePrivilegeEvent);
    menus.mixin(menuMap);
  }
};
exports.VXETablePluginCharts = VXETablePluginCharts;

if (typeof window !== 'undefined' && window.VXETable) {
  window.VXETable.use(VXETablePluginCharts);
}

var _default2 = VXETablePluginCharts;
exports["default"] = _default2;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbImNyZWF0ZUNoYXJ0TW9kYWwiLCJnZXRPcHRpb25zIiwicGFyYW1zIiwibWVudSIsIiRYTW9kYWwiLCJyZXNpemUiLCJtYXNrIiwibG9ja1ZpZXciLCJzaG93Rm9vdGVyIiwid2lkdGgiLCJoZWlnaHQiLCJ0aXRsZSIsIm5hbWUiLCJzbG90cyIsImgiLCJldmVudHMiLCJzaG93IiwiJGNoYXJ0IiwiZWNoYXJ0cyIsImluaXQiLCIkZWwiLCJxdWVyeVNlbGVjdG9yIiwic2V0T3B0aW9uIiwiY2xvc2UiLCJkaXNwb3NlIiwiaGlkZSIsInpvb20iLCJtZW51TWFwIiwiQ0hBUlRfQkFSX1hfQVhJUyIsIiR0YWJsZSIsImdldE1vdXNlQ2hlY2tlZHMiLCJyb3dzIiwiY29sdW1ucyIsImNoYXJ0UGFyYW1zIiwiY2F0ZWdvcnkiLCJjYXRlZ29yeUNvbHVtbiIsImdldENvbHVtbkJ5RmllbGQiLCJwcm9wZXJ0eSIsInNlcmllQ29sdW1ucyIsImZpbHRlciIsImNvbHVtbiIsImxlZ2VuZE9wdHMiLCJkYXRhIiwic2VyaWVzT3B0cyIsInhBeGlzT3B0cyIsInR5cGUiLCJtYXAiLCJyb3ciLCJYRVV0aWxzIiwiZ2V0IiwiZm9yRWFjaCIsInB1c2giLCJvcHRpb24iLCJ0b29sdGlwIiwidHJpZ2dlciIsImF4aXNQb2ludGVyIiwibGVnZW5kIiwieEF4aXMiLCJ5QXhpcyIsInNlcmllcyIsIkNIQVJUX0JBUl9ZX0FYSVMiLCJDSEFSVF9MSU5FIiwidG9vbGJveCIsImZlYXR1cmUiLCJzYXZlQXNJbWFnZSIsIkNIQVJUX1BJRSIsInNlcmllQ29sdW1uIiwibGVnZW5kRGF0YSIsInNlcmllc0RhdGEiLCJ2YWx1ZSIsImZvcm1hdHRlciIsIm9yaWVudCIsInJpZ2h0IiwidG9wIiwiYm90dG9tIiwicmFkaXVzIiwiY2VudGVyIiwiY2hlY2tQcml2aWxlZ2UiLCJpdGVtIiwiY29kZSIsImRpc2FibGVkIiwibGVuZ3RoIiwiaGFuZGxlUHJpdmlsZWdlRXZlbnQiLCJvcHRpb25zIiwibGlzdCIsImNoaWxkcmVuIiwiY2hpbGQiLCJWWEVUYWJsZVBsdWdpbkNoYXJ0cyIsImluc3RhbGwiLCJ4dGFibGUiLCJpbnRlcmNlcHRvciIsIm1lbnVzIiwiX21vZGFsIiwiRXJyb3IiLCJhZGQiLCJtaXhpbiIsIndpbmRvdyIsIlZYRVRhYmxlIiwidXNlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7Ozs7Ozs7O0FBRUEsU0FBU0EsZ0JBQVQsQ0FBMkJDLFVBQTNCLEVBQTBDO0FBQ3hDLFNBQU8sVUFBcUJDLE1BQXJCLEVBQWdDO0FBQUEsUUFDL0JDLElBRCtCLEdBQ3RCRCxNQURzQixDQUMvQkMsSUFEK0I7QUFFckMsU0FBS0MsT0FBTCxDQUFhO0FBQ1hDLE1BQUFBLE1BQU0sRUFBRSxJQURHO0FBRVhDLE1BQUFBLElBQUksRUFBRSxLQUZLO0FBR1hDLE1BQUFBLFFBQVEsRUFBRSxLQUhDO0FBSVhDLE1BQUFBLFVBQVUsRUFBRSxLQUpEO0FBS1hDLE1BQUFBLEtBQUssRUFBRSxHQUxJO0FBTVhDLE1BQUFBLE1BQU0sRUFBRSxHQU5HO0FBT1hDLE1BQUFBLEtBQUssRUFBRVIsSUFBSSxDQUFDUyxJQVBEO0FBUVhDLE1BQUFBLEtBQUssRUFBRTtBQUFBLHFDQUNJWCxNQURKLEVBQ2lCWSxDQURqQixFQUM0QjtBQUMvQixpQkFBTyxDQUNMQSxDQUFDLENBQUMsS0FBRCxFQUFRO0FBQ1AscUJBQU87QUFEQSxXQUFSLEVBRUUsQ0FDREEsQ0FBQyxDQUFDLEtBQUQsRUFBUTtBQUNQLHFCQUFPO0FBREEsV0FBUixDQURBLENBRkYsQ0FESSxDQUFQO0FBU0Q7QUFYSSxPQVJJO0FBcUJYQyxNQUFBQSxNQUFNLEVBQUU7QUFDTkMsUUFBQUEsSUFETSxrQkFDRjtBQUNGLGNBQU1DLE1BQU0sR0FBR0MsT0FBTyxDQUFDQyxJQUFSLENBQWEsS0FBS0MsR0FBTCxDQUFTQyxhQUFULENBQXVCLHFCQUF2QixDQUFiLENBQWY7QUFDQUosVUFBQUEsTUFBTSxDQUFDSyxT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QUFBQSxJQUFJLENBQUNPLFFBQUwsQ0FBY25DLE9BQWQsQ0FBc0IsVUFBQ29DLEtBQUQsRUFBZTtBQUNuQ1QsVUFBQUEsY0FBYyxDQUFDUyxLQUFELEVBQVFwRixNQUFSLENBQWQ7QUFDRCxTQUZEO0FBR0Q7QUFDRixLQVBEO0FBUUQsR0FURDtBQVVEO0FBRUQ7Ozs7O0FBR08sSUFBTXFGLG9CQUFvQixHQUFHO0FBQ2xDQyxFQUFBQSxPQURrQyxtQkFDekJDLE1BRHlCLEVBQ0Y7QUFBQSxRQUN4QkMsV0FEd0IsR0FDT0QsTUFEUCxDQUN4QkMsV0FEd0I7QUFBQSxRQUNYQyxLQURXLEdBQ09GLE1BRFAsQ0FDWEUsS0FEVztBQUFBLFFBQ0pDLE1BREksR0FDT0gsTUFEUCxDQUNKRyxNQURJOztBQUU5QixRQUFJLENBQUNBLE1BQUwsRUFBYTtBQUNYLFlBQU0sSUFBSUMsS0FBSixDQUFVLGlEQUFWLENBQU47QUFDRDs7QUFDREgsSUFBQUEsV0FBVyxDQUFDSSxHQUFaLENBQWdCLGdCQUFoQixFQUFrQ1osb0JBQWxDO0FBQ0FTLElBQUFBLEtBQUssQ0FBQ0ksS0FBTixDQUFZcEUsT0FBWjtBQUNEO0FBUmlDLENBQTdCOzs7QUFXUCxJQUFJLE9BQU9xRSxNQUFQLEtBQWtCLFdBQWxCLElBQWlDQSxNQUFNLENBQUNDLFFBQTVDLEVBQXNEO0FBQ3BERCxFQUFBQSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLEdBQWhCLENBQW9CWCxvQkFBcEI7QUFDRDs7Z0JBRWNBLG9CIiwiZmlsZSI6ImluZGV4LmNvbW1vbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBYRVV0aWxzIGZyb20gJ3hlLXV0aWxzL21ldGhvZHMveGUtdXRpbHMnXHJcbmltcG9ydCBWWEVUYWJsZSBmcm9tICd2eGUtdGFibGUvbGliL3Z4ZS10YWJsZSdcclxuaW1wb3J0ICogYXMgZWNoYXJ0cyBmcm9tICdlY2hhcnRzL2xpYi9lY2hhcnRzJ1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlQ2hhcnRNb2RhbCAoZ2V0T3B0aW9uczogYW55KSB7XHJcbiAgcmV0dXJuIGZ1bmN0aW9uICh0aGlzOiBhbnksIHBhcmFtczogYW55KSB7XHJcbiAgICBsZXQgeyBtZW51IH0gPSBwYXJhbXNcclxuICAgIHRoaXMuJFhNb2RhbCh7XHJcbiAgICAgIHJlc2l6ZTogdHJ1ZSxcclxuICAgICAgbWFzazogZmFsc2UsXHJcbiAgICAgIGxvY2tWaWV3OiBmYWxzZSxcclxuICAgICAgc2hvd0Zvb3RlcjogZmFsc2UsXHJcbiAgICAgIHdpZHRoOiA2MDAsXHJcbiAgICAgIGhlaWdodDogNDAwLFxyXG4gICAgICB0aXRsZTogbWVudS5uYW1lLFxyXG4gICAgICBzbG90czoge1xyXG4gICAgICAgIGRlZmF1bHQgKHBhcmFtczogYW55LCBoOiBGdW5jdGlvbikge1xyXG4gICAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgaCgnZGl2Jywge1xyXG4gICAgICAgICAgICAgIGNsYXNzOiAndnhlLWNoYXJ0LS13cmFwcGVyJ1xyXG4gICAgICAgICAgICB9LCBbXHJcbiAgICAgICAgICAgICAgaCgnZGl2Jywge1xyXG4gICAgICAgICAgICAgICAgY2xhc3M6ICd2eGUtY2hhcnQtLXBhbmVsJ1xyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIF0pXHJcbiAgICAgICAgICBdXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBldmVudHM6IHtcclxuICAgICAgICBzaG93ICh0aGlzOiBhbnkpIHtcclxuICAgICAgICAgIGNvbnN0ICRjaGFydCA9IGVjaGFydHMuaW5pdCh0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKCcudnhlLWNoYXJ0LS13cmFwcGVyJykpXHJcbiAgICAgICAgICAkY2hhcnQuc2V0T3B0aW9uKGdldE9wdGlvbnMocGFyYW1zKSlcclxuICAgICAgICAgIHRoaXMuJGNoYXJ0ID0gJGNoYXJ0XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjbG9zZSAodGhpczogYW55KSB7XHJcbiAgICAgICAgICAvLyDml6fniYjmnKzvvIzljbPlsIblup/lvINcclxuICAgICAgICAgIHRoaXMuJGNoYXJ0LmRpc3Bvc2UoKVxyXG4gICAgICAgICAgdGhpcy4kY2hhcnQgPSBudWxsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBoaWRlICh0aGlzOiBhbnkpIHtcclxuICAgICAgICAgIHRoaXMuJGNoYXJ0LmRpc3Bvc2UoKVxyXG4gICAgICAgICAgdGhpcy4kY2hhcnQgPSBudWxsXHJcbiAgICAgICAgfSxcclxuICAgICAgICB6b29tICh0aGlzOiBhbnkpIHtcclxuICAgICAgICAgIHRoaXMuJGNoYXJ0LnJlc2l6ZSgpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxufVxyXG5cclxuaW50ZXJmYWNlIGxlZ2VuZE9wdHMge1xyXG4gIGRhdGE6IEFycmF5PGFueT47XHJcbn1cclxuXHJcbmNvbnN0IG1lbnVNYXAgPSB7XHJcbiAgQ0hBUlRfQkFSX1hfQVhJUzogY3JlYXRlQ2hhcnRNb2RhbCgocGFyYW1zOiBhbnkpID0+IHtcclxuICAgIGNvbnN0IHsgJHRhYmxlLCBtZW51IH0gPSBwYXJhbXNcclxuICAgIGNvbnN0IHsgcm93cywgY29sdW1ucyB9ID0gJHRhYmxlLmdldE1vdXNlQ2hlY2tlZHMoKVxyXG4gICAgY29uc3QgeyBwYXJhbXM6IGNoYXJ0UGFyYW1zID0ge30gfSA9IG1lbnVcclxuICAgIGNvbnN0IHsgY2F0ZWdvcnkgfSA9IGNoYXJ0UGFyYW1zXHJcbiAgICBsZXQgY2F0ZWdvcnlDb2x1bW4gPSAkdGFibGUuZ2V0Q29sdW1uQnlGaWVsZChjYXRlZ29yeSB8fCBjb2x1bW5zWzBdLnByb3BlcnR5KVxyXG4gICAgbGV0IHNlcmllQ29sdW1ucyA9IGNvbHVtbnMuZmlsdGVyKChjb2x1bW46IGFueSkgPT4gY29sdW1uLnByb3BlcnR5ICE9PSBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eSlcclxuICAgIGxldCBsZWdlbmRPcHRzOiBsZWdlbmRPcHRzID0ge1xyXG4gICAgICBkYXRhOiBbXVxyXG4gICAgfVxyXG4gICAgbGV0IHNlcmllc09wdHM6IEFycmF5PGFueT4gPSBbXVxyXG4gICAgbGV0IHhBeGlzT3B0cyA9IHtcclxuICAgICAgdHlwZTogJ2NhdGVnb3J5JyxcclxuICAgICAgZGF0YTogcm93cy5tYXAoKHJvdzogYW55KSA9PiBYRVV0aWxzLmdldChyb3csIGNhdGVnb3J5Q29sdW1uLnByb3BlcnR5KSlcclxuICAgIH1cclxuICAgIHNlcmllQ29sdW1ucy5mb3JFYWNoKChjb2x1bW46IGFueSkgPT4ge1xyXG4gICAgICBsZWdlbmRPcHRzLmRhdGEucHVzaChjb2x1bW4udGl0bGUpXHJcbiAgICAgIHNlcmllc09wdHMucHVzaCh7XHJcbiAgICAgICAgbmFtZTogY29sdW1uLnRpdGxlLFxyXG4gICAgICAgIHR5cGU6ICdiYXInLFxyXG4gICAgICAgIGRhdGE6IHJvd3MubWFwKChyb3c6IGFueSkgPT4gWEVVdGlscy5nZXQocm93LCBjb2x1bW4ucHJvcGVydHkpKVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICAgIGNvbnN0IG9wdGlvbiA9IHtcclxuICAgICAgdG9vbHRpcDoge1xyXG4gICAgICAgIHRyaWdnZXI6ICdheGlzJyxcclxuICAgICAgICBheGlzUG9pbnRlcjoge1xyXG4gICAgICAgICAgdHlwZTogJ3NoYWRvdydcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGxlZ2VuZDogbGVnZW5kT3B0cyxcclxuICAgICAgeEF4aXM6IHhBeGlzT3B0cyxcclxuICAgICAgeUF4aXM6IHtcclxuICAgICAgICB0eXBlOiAndmFsdWUnXHJcbiAgICAgIH0sXHJcbiAgICAgIHNlcmllczogc2VyaWVzT3B0c1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9wdGlvblxyXG4gIH0pLFxyXG4gIENIQVJUX0JBUl9ZX0FYSVM6IGNyZWF0ZUNoYXJ0TW9kYWwoKHBhcmFtczogYW55KSA9PiB7XHJcbiAgICBjb25zdCB7ICR0YWJsZSwgbWVudSB9ID0gcGFyYW1zXHJcbiAgICBjb25zdCB7IHJvd3MsIGNvbHVtbnMgfSA9ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKClcclxuICAgIGNvbnN0IHsgcGFyYW1zOiBjaGFydFBhcmFtcyA9IHt9IH0gPSBtZW51XHJcbiAgICBjb25zdCB7IGNhdGVnb3J5IH0gPSBjaGFydFBhcmFtc1xyXG4gICAgbGV0IGNhdGVnb3J5Q29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5RmllbGQoY2F0ZWdvcnkgfHwgY29sdW1uc1swXS5wcm9wZXJ0eSlcclxuICAgIGxldCBzZXJpZUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpXHJcbiAgICBsZXQgbGVnZW5kT3B0czogbGVnZW5kT3B0cyA9IHtcclxuICAgICAgZGF0YTogW11cclxuICAgIH1cclxuICAgIGxldCBzZXJpZXNPcHRzOiBBcnJheTxhbnk+ID0gW11cclxuICAgIGxldCB4QXhpc09wdHMgPSB7XHJcbiAgICAgIHR5cGU6ICdjYXRlZ29yeScsXHJcbiAgICAgIGRhdGE6IHJvd3MubWFwKChyb3c6IGFueSkgPT4gWEVVdGlscy5nZXQocm93LCBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eSkpXHJcbiAgICB9XHJcbiAgICBzZXJpZUNvbHVtbnMuZm9yRWFjaCgoY29sdW1uOiBhbnkpID0+IHtcclxuICAgICAgbGVnZW5kT3B0cy5kYXRhLnB1c2goY29sdW1uLnRpdGxlKVxyXG4gICAgICBzZXJpZXNPcHRzLnB1c2goe1xyXG4gICAgICAgIG5hbWU6IGNvbHVtbi50aXRsZSxcclxuICAgICAgICB0eXBlOiAnYmFyJyxcclxuICAgICAgICBkYXRhOiByb3dzLm1hcCgocm93OiBhbnkpID0+IFhFVXRpbHMuZ2V0KHJvdywgY29sdW1uLnByb3BlcnR5KSlcclxuICAgICAgfSlcclxuICAgIH0pXHJcbiAgICBjb25zdCBvcHRpb24gPSB7XHJcbiAgICAgIHRvb2x0aXA6IHtcclxuICAgICAgICB0cmlnZ2VyOiAnYXhpcycsXHJcbiAgICAgICAgYXhpc1BvaW50ZXI6IHtcclxuICAgICAgICAgIHR5cGU6ICdzaGFkb3cnXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBsZWdlbmQ6IGxlZ2VuZE9wdHMsXHJcbiAgICAgIHhBeGlzOiB4QXhpc09wdHMsXHJcbiAgICAgIHlBeGlzOiB7XHJcbiAgICAgICAgdHlwZTogJ3ZhbHVlJ1xyXG4gICAgICB9LFxyXG4gICAgICBzZXJpZXM6IHNlcmllc09wdHNcclxuICAgIH1cclxuICAgIHJldHVybiBvcHRpb25cclxuICB9KSxcclxuICBDSEFSVF9MSU5FOiBjcmVhdGVDaGFydE1vZGFsKChwYXJhbXM6IGFueSkgPT4ge1xyXG4gICAgY29uc3QgeyAkdGFibGUsIG1lbnUgfSA9IHBhcmFtc1xyXG4gICAgY29uc3QgeyByb3dzLCBjb2x1bW5zIH0gPSAkdGFibGUuZ2V0TW91c2VDaGVja2VkcygpXHJcbiAgICBjb25zdCB7IHBhcmFtczogY2hhcnRQYXJhbXMgPSB7fSB9ID0gbWVudVxyXG4gICAgY29uc3QgeyBjYXRlZ29yeSB9ID0gY2hhcnRQYXJhbXNcclxuICAgIGxldCBjYXRlZ29yeUNvbHVtbiA9ICR0YWJsZS5nZXRDb2x1bW5CeUZpZWxkKGNhdGVnb3J5IHx8IGNvbHVtbnNbMF0ucHJvcGVydHkpXHJcbiAgICBsZXQgc2VyaWVDb2x1bW5zID0gY29sdW1ucy5maWx0ZXIoKGNvbHVtbjogYW55KSA9PiBjb2x1bW4ucHJvcGVydHkgIT09IGNhdGVnb3J5Q29sdW1uLnByb3BlcnR5KVxyXG4gICAgbGV0IGxlZ2VuZE9wdHM6IGxlZ2VuZE9wdHMgPSB7XHJcbiAgICAgIGRhdGE6IFtdXHJcbiAgICB9XHJcbiAgICBsZXQgc2VyaWVzT3B0czogQXJyYXk8YW55PiA9IFtdXHJcbiAgICBsZXQgeEF4aXNPcHRzID0ge1xyXG4gICAgICB0eXBlOiAnY2F0ZWdvcnknLFxyXG4gICAgICBkYXRhOiByb3dzLm1hcCgocm93OiBhbnkpID0+IFhFVXRpbHMuZ2V0KHJvdywgY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpKVxyXG4gICAgfVxyXG4gICAgc2VyaWVDb2x1bW5zLmZvckVhY2goKGNvbHVtbjogYW55KSA9PiB7XHJcbiAgICAgIGxlZ2VuZE9wdHMuZGF0YS5wdXNoKGNvbHVtbi50aXRsZSlcclxuICAgICAgc2VyaWVzT3B0cy5wdXNoKHtcclxuICAgICAgICBuYW1lOiBjb2x1bW4udGl0bGUsXHJcbiAgICAgICAgdHlwZTogJ2xpbmUnLFxyXG4gICAgICAgIGRhdGE6IHJvd3MubWFwKChyb3c6IGFueSkgPT4gWEVVdGlscy5nZXQocm93LCBjb2x1bW4ucHJvcGVydHkpKVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICAgIGxldCBvcHRpb24gPSB7XHJcbiAgICAgIHRvb2x0aXA6IHtcclxuICAgICAgICB0cmlnZ2VyOiAnYXhpcydcclxuICAgICAgfSxcclxuICAgICAgbGVnZW5kOiBsZWdlbmRPcHRzLFxyXG4gICAgICB0b29sYm94OiB7XHJcbiAgICAgICAgZmVhdHVyZToge1xyXG4gICAgICAgICAgc2F2ZUFzSW1hZ2U6IHt9XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICB4QXhpczogeEF4aXNPcHRzLFxyXG4gICAgICB5QXhpczoge1xyXG4gICAgICAgIHR5cGU6ICd2YWx1ZSdcclxuICAgICAgfSxcclxuICAgICAgc2VyaWVzOiBzZXJpZXNPcHRzXHJcbiAgICB9XHJcbiAgICByZXR1cm4gb3B0aW9uXHJcbiAgfSksXHJcbiAgQ0hBUlRfUElFOiBjcmVhdGVDaGFydE1vZGFsKChwYXJhbXM6IGFueSkgPT4ge1xyXG4gICAgY29uc3QgeyAkdGFibGUsIG1lbnUgfSA9IHBhcmFtc1xyXG4gICAgY29uc3QgeyByb3dzLCBjb2x1bW5zIH0gPSAkdGFibGUuZ2V0TW91c2VDaGVja2VkcygpXHJcbiAgICBjb25zdCB7IHBhcmFtczogY2hhcnRQYXJhbXMgPSB7fSB9ID0gbWVudVxyXG4gICAgY29uc3QgeyBjYXRlZ29yeSB9ID0gY2hhcnRQYXJhbXNcclxuICAgIGxldCBjYXRlZ29yeUNvbHVtbiA9ICR0YWJsZS5nZXRDb2x1bW5CeUZpZWxkKGNhdGVnb3J5IHx8IGNvbHVtbnNbMF0ucHJvcGVydHkpXHJcbiAgICBsZXQgc2VyaWVDb2x1bW5zID0gY29sdW1ucy5maWx0ZXIoKGNvbHVtbjogYW55KSA9PiBjb2x1bW4ucHJvcGVydHkgIT09IGNhdGVnb3J5Q29sdW1uLnByb3BlcnR5KVxyXG4gICAgbGV0IHNlcmllQ29sdW1uID0gc2VyaWVDb2x1bW5zWzBdXHJcbiAgICBsZXQgbGVnZW5kRGF0YSA9IHJvd3MubWFwKChyb3c6IGFueSkgPT4gWEVVdGlscy5nZXQocm93LCBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eSkpXHJcbiAgICBsZXQgc2VyaWVzRGF0YTogQXJyYXk8YW55PiA9IFtdXHJcbiAgICByb3dzLmZvckVhY2goKHJvdzogYW55KSA9PiB7XHJcbiAgICAgIHNlcmllc0RhdGEucHVzaCh7XHJcbiAgICAgICAgbmFtZTogWEVVdGlscy5nZXQocm93LCBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eSksXHJcbiAgICAgICAgdmFsdWU6IFhFVXRpbHMuZ2V0KHJvdywgc2VyaWVDb2x1bW4ucHJvcGVydHkpXHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gICAgbGV0IG9wdGlvbiA9IHtcclxuICAgICAgdG9vbHRpcDoge1xyXG4gICAgICAgIHRyaWdnZXI6ICdpdGVtJyxcclxuICAgICAgICBmb3JtYXR0ZXI6ICd7YX0gPGJyLz57Yn0gOiB7Y30gKHtkfSUpJ1xyXG4gICAgICB9LFxyXG4gICAgICBsZWdlbmQ6IHtcclxuICAgICAgICB0eXBlOiAnc2Nyb2xsJyxcclxuICAgICAgICBvcmllbnQ6ICd2ZXJ0aWNhbCcsXHJcbiAgICAgICAgcmlnaHQ6IDEwLFxyXG4gICAgICAgIHRvcDogMjAsXHJcbiAgICAgICAgYm90dG9tOiAyMCxcclxuICAgICAgICBkYXRhOiBsZWdlbmREYXRhXHJcbiAgICAgICAgLy8gc2VsZWN0ZWQ6IGRhdGEuc2VsZWN0ZWRcclxuICAgICAgfSxcclxuICAgICAgc2VyaWVzOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgbmFtZTogc2VyaWVDb2x1bW4udGl0bGUsXHJcbiAgICAgICAgICB0eXBlOiAncGllJyxcclxuICAgICAgICAgIHJhZGl1czogJzUwJScsXHJcbiAgICAgICAgICBjZW50ZXI6IFsnNDAlJywgJzUwJSddLFxyXG4gICAgICAgICAgZGF0YTogc2VyaWVzRGF0YVxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9wdGlvblxyXG4gIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoZWNrUHJpdmlsZWdlIChpdGVtOiBhbnksIHBhcmFtczogYW55KSB7XHJcbiAgY29uc3QgeyAkdGFibGUgfSA9IHBhcmFtc1xyXG4gIGNvbnN0IHsgY29kZSwgcGFyYW1zOiBjaGFydFBhcmFtcyA9IHt9IH0gPSBpdGVtXHJcbiAgc3dpdGNoIChjb2RlKSB7XHJcbiAgICBjYXNlICdDSEFSVF9CQVJfWF9BWElTJzpcclxuICAgIGNhc2UgJ0NIQVJUX0JBUl9ZX0FYSVMnOlxyXG4gICAgY2FzZSAnQ0hBUlRfTElORSc6IHtcclxuICAgICAgY29uc3QgeyByb3dzLCBjb2x1bW5zIH0gPSAkdGFibGUuZ2V0TW91c2VDaGVja2VkcygpXHJcbiAgICAgIGNvbnN0IHsgY2F0ZWdvcnkgfSA9IGNoYXJ0UGFyYW1zXHJcbiAgICAgIGlmIChjYXRlZ29yeSkge1xyXG4gICAgICAgIGxldCBzZXJpZUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnkpXHJcbiAgICAgICAgaXRlbS5kaXNhYmxlZCA9ICFyb3dzLmxlbmd0aCB8fCBzZXJpZUNvbHVtbnMubGVuZ3RoIDwgMVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGl0ZW0uZGlzYWJsZWQgPSAhcm93cy5sZW5ndGggfHwgY29sdW1ucy5sZW5ndGggPCAyXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgICAgYnJlYWtcclxuICAgIGNhc2UgJ0NIQVJUX1BJRSc6IHtcclxuICAgICAgY29uc3QgeyByb3dzLCBjb2x1bW5zIH0gPSAkdGFibGUuZ2V0TW91c2VDaGVja2VkcygpXHJcbiAgICAgIGNvbnN0IHsgY2F0ZWdvcnkgfSA9IGNoYXJ0UGFyYW1zXHJcbiAgICAgIGlmIChjYXRlZ29yeSkge1xyXG4gICAgICAgIGxldCBzZXJpZUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnkpXHJcbiAgICAgICAgaXRlbS5kaXNhYmxlZCA9ICFyb3dzLmxlbmd0aCB8fCBzZXJpZUNvbHVtbnMubGVuZ3RoICE9PSAxXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaXRlbS5kaXNhYmxlZCA9ICFyb3dzLmxlbmd0aCB8fCBjb2x1bW5zLmxlbmd0aCAhPT0gMlxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAgIGJyZWFrXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVQcml2aWxlZ2VFdmVudCAocGFyYW1zOiBhbnkpIHtcclxuICBwYXJhbXMub3B0aW9ucy5mb3JFYWNoKChsaXN0OiBBcnJheTxhbnk+KSA9PiB7XHJcbiAgICBsaXN0LmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICBjaGVja1ByaXZpbGVnZShpdGVtLCBwYXJhbXMpXHJcbiAgICAgIGlmIChpdGVtLmNoaWxkcmVuKSB7XHJcbiAgICAgICAgaXRlbS5jaGlsZHJlbi5mb3JFYWNoKChjaGlsZDogYW55KSA9PiB7XHJcbiAgICAgICAgICBjaGVja1ByaXZpbGVnZShjaGlsZCwgcGFyYW1zKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIOWfuuS6jiB2eGUtdGFibGUg6KGo5qC855qE5Zu+6KGo5riy5p+T5o+S5Lu2XHJcbiAqL1xyXG5leHBvcnQgY29uc3QgVlhFVGFibGVQbHVnaW5DaGFydHMgPSB7XHJcbiAgaW5zdGFsbCAoeHRhYmxlOiB0eXBlb2YgVlhFVGFibGUpIHtcclxuICAgIGxldCB7IGludGVyY2VwdG9yLCBtZW51cywgX21vZGFsIH0gPSB4dGFibGVcclxuICAgIGlmICghX21vZGFsKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignW3Z4ZS10YWJsZS1wbHVnaW4tY2hhcnRzXSByZXF1aXJlIE1vZGFsIG1vZHVsZS4nKVxyXG4gICAgfVxyXG4gICAgaW50ZXJjZXB0b3IuYWRkKCdldmVudC5zaG93TWVudScsIGhhbmRsZVByaXZpbGVnZUV2ZW50KVxyXG4gICAgbWVudXMubWl4aW4obWVudU1hcClcclxuICB9XHJcbn1cclxuXHJcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVlhFVGFibGUpIHtcclxuICB3aW5kb3cuVlhFVGFibGUudXNlKFZYRVRhYmxlUGx1Z2luQ2hhcnRzKVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBWWEVUYWJsZVBsdWdpbkNoYXJ0c1xyXG4iXX0=

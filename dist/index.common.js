"use strict";

exports.__esModule = true;

var xe_utils_1 = require("xe-utils/methods/xe-utils");

var echarts = require("echarts/lib/echarts");

function createChartModal(getOptions) {
  return function (params) {
    var menu = params.menu;
    this.$XModal({
      resize: true,
      mask: false,
      lockView: false,
      showFooter: false,
      width: 600,
      height: 400,
      title: menu.name,
      slots: {
        "default": function _default(params, h) {
          return [h('div', {
            "class": 'vxe-chart--wrapper'
          }, [h('div', {
            "class": 'vxe-chart--panel'
          })])];
        }
      },
      events: {
        show: function show() {
          var $chart = echarts.init(this.$el.querySelector('.vxe-chart--wrapper'));
          $chart.setOption(getOptions(params));
          this.$chart = $chart;
        },
        close: function close() {
          // 旧版本，即将废弃
          this.$chart.dispose();
          this.$chart = null;
        },
        hide: function hide() {
          this.$chart.dispose();
          this.$chart = null;
        },
        zoom: function zoom() {
          this.$chart.resize();
        }
      }
    });
  };
}

var menuMap = {
  CHART_BAR_X_AXIS: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _a = $table.getMouseCheckeds(),
        rows = _a.rows,
        columns = _a.columns;

    var _b = menu.params,
        chartParams = _b === void 0 ? {} : _b;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var legendOpts = {
      data: []
    };
    var seriesOpts = [];
    var xAxisOpts = {
      type: 'category',
      data: rows.map(function (row) {
        return xe_utils_1["default"].get(row, categoryColumn.property);
      })
    };
    serieColumns.forEach(function (column) {
      legendOpts.data.push(column.title);
      seriesOpts.push({
        name: column.title,
        type: 'bar',
        data: rows.map(function (row) {
          return xe_utils_1["default"].get(row, column.property);
        })
      });
    });
    var option = {
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'shadow'
        }
      },
      legend: legendOpts,
      xAxis: xAxisOpts,
      yAxis: {
        type: 'value'
      },
      series: seriesOpts
    };
    return option;
  }),
  CHART_BAR_Y_AXIS: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _a = $table.getMouseCheckeds(),
        rows = _a.rows,
        columns = _a.columns;

    var _b = menu.params,
        chartParams = _b === void 0 ? {} : _b;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var legendOpts = {
      data: []
    };
    var seriesOpts = [];
    var xAxisOpts = {
      type: 'category',
      data: rows.map(function (row) {
        return xe_utils_1["default"].get(row, categoryColumn.property);
      })
    };
    serieColumns.forEach(function (column) {
      legendOpts.data.push(column.title);
      seriesOpts.push({
        name: column.title,
        type: 'bar',
        data: rows.map(function (row) {
          return xe_utils_1["default"].get(row, column.property);
        })
      });
    });
    var option = {
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'shadow'
        }
      },
      legend: legendOpts,
      xAxis: xAxisOpts,
      yAxis: {
        type: 'value'
      },
      series: seriesOpts
    };
    return option;
  }),
  CHART_LINE: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _a = $table.getMouseCheckeds(),
        rows = _a.rows,
        columns = _a.columns;

    var _b = menu.params,
        chartParams = _b === void 0 ? {} : _b;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var legendOpts = {
      data: []
    };
    var seriesOpts = [];
    var xAxisOpts = {
      type: 'category',
      data: rows.map(function (row) {
        return xe_utils_1["default"].get(row, categoryColumn.property);
      })
    };
    serieColumns.forEach(function (column) {
      legendOpts.data.push(column.title);
      seriesOpts.push({
        name: column.title,
        type: 'line',
        data: rows.map(function (row) {
          return xe_utils_1["default"].get(row, column.property);
        })
      });
    });
    var option = {
      tooltip: {
        trigger: 'axis'
      },
      legend: legendOpts,
      toolbox: {
        feature: {
          saveAsImage: {}
        }
      },
      xAxis: xAxisOpts,
      yAxis: {
        type: 'value'
      },
      series: seriesOpts
    };
    return option;
  }),
  CHART_PIE: createChartModal(function (params) {
    var $table = params.$table,
        menu = params.menu;

    var _a = $table.getMouseCheckeds(),
        rows = _a.rows,
        columns = _a.columns;

    var _b = menu.params,
        chartParams = _b === void 0 ? {} : _b;
    var category = chartParams.category;
    var categoryColumn = $table.getColumnByField(category || columns[0].property);
    var serieColumns = columns.filter(function (column) {
      return column.property !== categoryColumn.property;
    });
    var serieColumn = serieColumns[0];
    var legendData = rows.map(function (row) {
      return xe_utils_1["default"].get(row, categoryColumn.property);
    });
    var seriesData = [];
    rows.forEach(function (row) {
      seriesData.push({
        name: xe_utils_1["default"].get(row, categoryColumn.property),
        value: xe_utils_1["default"].get(row, serieColumn.property)
      });
    });
    var option = {
      tooltip: {
        trigger: 'item',
        formatter: '{a} <br/>{b} : {c} ({d}%)'
      },
      legend: {
        type: 'scroll',
        orient: 'vertical',
        right: 10,
        top: 20,
        bottom: 20,
        data: legendData // selected: data.selected

      },
      series: [{
        name: serieColumn.title,
        type: 'pie',
        radius: '50%',
        center: ['40%', '50%'],
        data: seriesData
      }]
    };
    return option;
  })
};

function checkPrivilege(item, params) {
  var $table = params.$table;
  var code = item.code,
      _a = item.params,
      chartParams = _a === void 0 ? {} : _a;

  switch (code) {
    case 'CHART_BAR_X_AXIS':
    case 'CHART_BAR_Y_AXIS':
    case 'CHART_LINE':
      {
        var _b = $table.getMouseCheckeds(),
            rows = _b.rows,
            columns = _b.columns;

        var category_1 = chartParams.category;

        if (category_1) {
          var serieColumns = columns.filter(function (column) {
            return column.property !== category_1;
          });
          item.disabled = !rows.length || serieColumns.length < 1;
        } else {
          item.disabled = !rows.length || columns.length < 2;
        }
      }
      break;

    case 'CHART_PIE':
      {
        var _c = $table.getMouseCheckeds(),
            rows = _c.rows,
            columns = _c.columns;

        var category_2 = chartParams.category;

        if (category_2) {
          var serieColumns = columns.filter(function (column) {
            return column.property !== category_2;
          });
          item.disabled = !rows.length || serieColumns.length !== 1;
        } else {
          item.disabled = !rows.length || columns.length !== 2;
        }
      }
      break;
  }
}

function handlePrivilegeEvent(params) {
  params.options.forEach(function (list) {
    list.forEach(function (item) {
      checkPrivilege(item, params);

      if (item.children) {
        item.children.forEach(function (child) {
          checkPrivilege(child, params);
        });
      }
    });
  });
}
/**
 * 基于 vxe-table 表格的图表渲染插件
 */


exports.VXETablePluginCharts = {
  install: function install(xtable) {
    var interceptor = xtable.interceptor,
        menus = xtable.menus,
        _modal = xtable._modal;

    if (!_modal) {
      throw new Error('[vxe-table-plugin-charts] require Modal module.');
    }

    interceptor.add('event.show_menu', handlePrivilegeEvent);
    menus.mixin(menuMap);
  }
};

if (typeof window !== 'undefined' && window.VXETable) {
  window.VXETable.use(exports.VXETablePluginCharts);
}

exports["default"] = exports.VXETablePluginCharts;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIiwiaW5kZXgudHMiXSwibmFtZXMiOlsiZXhwb3J0cyIsIl9fZXNNb2R1bGUiLCJ4ZV91dGlsc18xIiwicmVxdWlyZSIsImVjaGFydHMiLCJjcmVhdGVDaGFydE1vZGFsIiwiZ2V0T3B0aW9ucyIsInBhcmFtcyIsIm1lbnUiLCIkWE1vZGFsIiwicmVzaXplIiwibWFzayIsImxvY2tWaWV3Iiwic2hvd0Zvb3RlciIsIndpZHRoIiwiaGVpZ2h0IiwidGl0bGUiLCJuYW1lIiwic2xvdHMiLCJoIiwiZXZlbnRzIiwic2hvdyIsIiRjaGFydCIsImluaXQiLCIkZWwiLCJxdWVyeVNlbGVjdG9yIiwic2V0T3B0aW9uIiwiY2xvc2UiLCJkaXNwb3NlIiwiaGlkZSIsInpvb20iLCJtZW51TWFwIiwiQ0hBUlRfQkFSX1hfQVhJUyIsIiR0YWJsZSIsIl9hIiwiZ2V0TW91c2VDaGVja2VkcyIsInJvd3MiLCJjb2x1bW5zIiwiX2IiLCJjaGFydFBhcmFtcyIsImNhdGVnb3J5IiwiY2F0ZWdvcnlDb2x1bW4iLCJnZXRDb2x1bW5CeUZpZWxkIiwicHJvcGVydHkiLCJzZXJpZUNvbHVtbnMiLCJmaWx0ZXIiLCJjb2x1bW4iLCJsZWdlbmRPcHRzIiwiZGF0YSIsInNlcmllc09wdHMiLCJ4QXhpc09wdHMiLCJ0eXBlIiwibWFwIiwicm93IiwiZ2V0IiwiZm9yRWFjaCIsInB1c2giLCJvcHRpb24iLCJ0b29sdGlwIiwidHJpZ2dlciIsImF4aXNQb2ludGVyIiwibGVnZW5kIiwieEF4aXMiLCJ5QXhpcyIsInNlcmllcyIsIkNIQVJUX0JBUl9ZX0FYSVMiLCJDSEFSVF9MSU5FIiwidG9vbGJveCIsImZlYXR1cmUiLCJzYXZlQXNJbWFnZSIsIkNIQVJUX1BJRSIsInNlcmllQ29sdW1uIiwibGVnZW5kRGF0YSIsInNlcmllc0RhdGEiLCJ2YWx1ZSIsImZvcm1hdHRlciIsIm9yaWVudCIsInJpZ2h0IiwidG9wIiwiYm90dG9tIiwicmFkaXVzIiwiY2VudGVyIiwiY2hlY2tQcml2aWxlZ2UiLCJpdGVtIiwiY29kZSIsImNhdGVnb3J5XzEiLCJkaXNhYmxlZCIsImxlbmd0aCIsIl9jIiwiY2F0ZWdvcnlfMiIsImhhbmRsZVByaXZpbGVnZUV2ZW50Iiwib3B0aW9ucyIsImxpc3QiLCJjaGlsZHJlbiIsImNoaWxkIiwiVlhFVGFibGVQbHVnaW5DaGFydHMiLCJpbnN0YWxsIiwieHRhYmxlIiwiaW50ZXJjZXB0b3IiLCJtZW51cyIsIl9tb2RhbCIsIkVycm9yIiwiYWRkIiwibWl4aW4iLCJ3aW5kb3ciLCJWWEVUYWJsZSIsInVzZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0FBLE9BQU8sQ0FBQ0MsVUFBUixHQUFxQixJQUFyQjs7QUNEQSxJQUFBQyxVQUFBLEdBQUFDLE9BQUEsQ0FBQSwyQkFBQSxDQUFBOztBQUNBLElBQUFDLE9BQUEsR0FBQUQsT0FBQSxDQUFBLHFCQUFBLENBQUE7O0FBR0EsU0FBU0UsZ0JBQVQsQ0FBMkJDLFVBQTNCLEVBQTBDO0FBQ3hDLFNBQU8sVUFBVUMsTUFBVixFQUFxQjtBQUNwQixRQUFBQyxJQUFBLEdBQUFELE1BQUEsQ0FBQUMsSUFBQTtBQUNOLFNBQUtDLE9BQUwsQ0FBYTtBQUNYQyxNQUFBQSxNQUFNLEVBQUUsSUFERztBQUVYQyxNQUFBQSxJQUFJLEVBQUUsS0FGSztBQUdYQyxNQUFBQSxRQUFRLEVBQUUsS0FIQztBQUlYQyxNQUFBQSxVQUFVLEVBQUUsS0FKRDtBQUtYQyxNQUFBQSxLQUFLLEVBQUUsR0FMSTtBQU1YQyxNQUFBQSxNQUFNLEVBQUUsR0FORztBQU9YQyxNQUFBQSxLQUFLLEVBQUVSLElBQUksQ0FBQ1MsSUFQRDtBQVFYQyxNQUFBQSxLQUFLLEVBQUU7QUFDTCxtQkFBQSxrQkFBU1gsTUFBVCxFQUFzQlksQ0FBdEIsRUFBaUM7QUFDL0IsaUJBQU8sQ0FDTEEsQ0FBQyxDQUFDLEtBQUQsRUFBUTtBQUNQLHFCQUFPO0FBREEsV0FBUixFQUVFLENBQ0RBLENBQUMsQ0FBQyxLQUFELEVBQVE7QUFDUCxxQkFBTztBQURBLFdBQVIsQ0FE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Ozs7O0FBR2FQLE9BQUEsQ0FBQStGLG9CQUFBLEdBQXVCO0FBQ2xDQyxFQUFBQSxPQUFPLEVBQVAsaUJBQVNDLE1BQVQsRUFBZ0M7QUFDeEIsUUFBQUMsV0FBQSxHQUFBRCxNQUFBLENBQUFDLFdBQUE7QUFBQSxRQUFhQyxLQUFBLEdBQUFGLE1BQUEsQ0FBQUUsS0FBYjtBQUFBLFFBQW9CQyxNQUFBLEdBQUFILE1BQUEsQ0FBQUcsTUFBcEI7O0FBQ04sUUFBSSxDQUFDQSxNQUFMLEVBQWE7QUFDWCxZQUFNLElBQUlDLEtBQUosQ0FBVSxpREFBVixDQUFOO0FBQ0Q7O0FBQ0RILElBQUFBLFdBQVcsQ0FBQ0ksR0FBWixDQUFnQixpQkFBaEIsRUFBbUNaLG9CQUFuQztBQUNBUyxJQUFBQSxLQUFLLENBQUNJLEtBQU4sQ0FBWXhFLE9BQVo7QUFDRDtBQVJpQyxDQUF2Qjs7QUFXYixJQUFJLE9BQU95RSxNQUFQLEtBQWtCLFdBQWxCLElBQWlDQSxNQUFNLENBQUNDLFFBQTVDLEVBQXNEO0FBQ3BERCxFQUFBQSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLEdBQWhCLENBQW9CMUcsT0FBQSxDQUFBK0Ysb0JBQXBCO0FBQ0Q7O0FBRUQvRixPQUFBLENBQUEsU0FBQSxDQUFBLEdBQWVBLE9BQUEsQ0FBQStGLG9CQUFmIiwiZmlsZSI6ImluZGV4LmNvbW1vbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbnZhciB4ZV91dGlsc18xID0gcmVxdWlyZShcInhlLXV0aWxzL21ldGhvZHMveGUtdXRpbHNcIik7XG52YXIgZWNoYXJ0cyA9IHJlcXVpcmUoXCJlY2hhcnRzL2xpYi9lY2hhcnRzXCIpO1xuZnVuY3Rpb24gY3JlYXRlQ2hhcnRNb2RhbChnZXRPcHRpb25zKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIG1lbnUgPSBwYXJhbXMubWVudTtcbiAgICAgICAgdGhpcy4kWE1vZGFsKHtcbiAgICAgICAgICAgIHJlc2l6ZTogdHJ1ZSxcbiAgICAgICAgICAgIG1hc2s6IGZhbHNlLFxuICAgICAgICAgICAgbG9ja1ZpZXc6IGZhbHNlLFxuICAgICAgICAgICAgc2hvd0Zvb3RlcjogZmFsc2UsXG4gICAgICAgICAgICB3aWR0aDogNjAwLFxuICAgICAgICAgICAgaGVpZ2h0OiA0MDAsXG4gICAgICAgICAgICB0aXRsZTogbWVudS5uYW1lLFxuICAgICAgICAgICAgc2xvdHM6IHtcbiAgICAgICAgICAgICAgICBcImRlZmF1bHRcIjogZnVuY3Rpb24gKHBhcmFtcywgaCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgICAgICAgICAgaCgnZGl2Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xhc3NcIjogJ3Z4ZS1jaGFydC0td3JhcHBlcidcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoKCdkaXYnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xhc3NcIjogJ3Z4ZS1jaGFydC0tcGFuZWwnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV2ZW50czoge1xuICAgICAgICAgICAgICAgIHNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRjaGFydCA9IGVjaGFydHMuaW5pdCh0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKCcudnhlLWNoYXJ0LS13cmFwcGVyJykpO1xuICAgICAgICAgICAgICAgICAgICAkY2hhcnQuc2V0T3B0aW9uKGdldE9wdGlvbnMocGFyYW1zKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNoYXJ0ID0gJGNoYXJ0O1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8g5pen54mI5pys77yM5Y2z5bCG5bqf5byDXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNoYXJ0LmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY2hhcnQgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaGlkZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjaGFydC5kaXNwb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNoYXJ0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHpvb206IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY2hhcnQucmVzaXplKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xufVxudmFyIG1lbnVNYXAgPSB7XG4gICAgQ0hBUlRfQkFSX1hfQVhJUzogY3JlYXRlQ2hhcnRNb2RhbChmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBwYXJhbXMuJHRhYmxlLCBtZW51ID0gcGFyYW1zLm1lbnU7XG4gICAgICAgIHZhciBfYSA9ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKCksIHJvd3MgPSBfYS5yb3dzLCBjb2x1bW5zID0gX2EuY29sdW1ucztcbiAgICAgICAgdmFyIF9iID0gbWVudS5wYXJhbXMsIGNoYXJ0UGFyYW1zID0gX2IgPT09IHZvaWQgMCA/IHt9IDogX2I7XG4gICAgICAgIHZhciBjYXRlZ29yeSA9IGNoYXJ0UGFyYW1zLmNhdGVnb3J5O1xuICAgICAgICB2YXIgY2F0ZWdvcnlDb2x1bW4gPSAkdGFibGUuZ2V0Q29sdW1uQnlGaWVsZChjYXRlZ29yeSB8fCBjb2x1bW5zWzBdLnByb3BlcnR5KTtcbiAgICAgICAgdmFyIHNlcmllQ29sdW1ucyA9IGNvbHVtbnMuZmlsdGVyKGZ1bmN0aW9uIChjb2x1bW4pIHsgcmV0dXJuIGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHk7IH0pO1xuICAgICAgICB2YXIgbGVnZW5kT3B0cyA9IHtcbiAgICAgICAgICAgIGRhdGE6IFtdXG4gICAgICAgIH07XG4gICAgICAgIHZhciBzZXJpZXNPcHRzID0gW107XG4gICAgICAgIHZhciB4QXhpc09wdHMgPSB7XG4gICAgICAgICAgICB0eXBlOiAnY2F0ZWdvcnknLFxuICAgICAgICAgICAgZGF0YTogcm93cy5tYXAoZnVuY3Rpb24gKHJvdykgeyByZXR1cm4geGVfdXRpbHNfMVtcImRlZmF1bHRcIl0uZ2V0KHJvdywgY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpOyB9KVxuICAgICAgICB9O1xuICAgICAgICBzZXJpZUNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG4gICAgICAgICAgICBsZWdlbmRPcHRzLmRhdGEucHVzaChjb2x1bW4udGl0bGUpO1xuICAgICAgICAgICAgc2VyaWVzT3B0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICBuYW1lOiBjb2x1bW4udGl0bGUsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2JhcicsXG4gICAgICAgICAgICAgICAgZGF0YTogcm93cy5tYXAoZnVuY3Rpb24gKHJvdykgeyByZXR1cm4geGVfdXRpbHNfMVtcImRlZmF1bHRcIl0uZ2V0KHJvdywgY29sdW1uLnByb3BlcnR5KTsgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIG9wdGlvbiA9IHtcbiAgICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgICAgICB0cmlnZ2VyOiAnYXhpcycsXG4gICAgICAgICAgICAgICAgYXhpc1BvaW50ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3NoYWRvdydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGVnZW5kOiBsZWdlbmRPcHRzLFxuICAgICAgICAgICAgeEF4aXM6IHhBeGlzT3B0cyxcbiAgICAgICAgICAgIHlBeGlzOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3ZhbHVlJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlcmllczogc2VyaWVzT3B0c1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gb3B0aW9uO1xuICAgIH0pLFxuICAgIENIQVJUX0JBUl9ZX0FYSVM6IGNyZWF0ZUNoYXJ0TW9kYWwoZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB2YXIgJHRhYmxlID0gcGFyYW1zLiR0YWJsZSwgbWVudSA9IHBhcmFtcy5tZW51O1xuICAgICAgICB2YXIgX2EgPSAkdGFibGUuZ2V0TW91c2VDaGVja2VkcygpLCByb3dzID0gX2Eucm93cywgY29sdW1ucyA9IF9hLmNvbHVtbnM7XG4gICAgICAgIHZhciBfYiA9IG1lbnUucGFyYW1zLCBjaGFydFBhcmFtcyA9IF9iID09PSB2b2lkIDAgPyB7fSA6IF9iO1xuICAgICAgICB2YXIgY2F0ZWdvcnkgPSBjaGFydFBhcmFtcy5jYXRlZ29yeTtcbiAgICAgICAgdmFyIGNhdGVnb3J5Q29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5RmllbGQoY2F0ZWdvcnkgfHwgY29sdW1uc1swXS5wcm9wZXJ0eSk7XG4gICAgICAgIHZhciBzZXJpZUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcihmdW5jdGlvbiAoY29sdW1uKSB7IHJldHVybiBjb2x1bW4ucHJvcGVydHkgIT09IGNhdGVnb3J5Q29sdW1uLnByb3BlcnR5OyB9KTtcbiAgICAgICAgdmFyIGxlZ2VuZE9wdHMgPSB7XG4gICAgICAgICAgICBkYXRhOiBbXVxuICAgICAgICB9O1xuICAgICAgICB2YXIgc2VyaWVzT3B0cyA9IFtdO1xuICAgICAgICB2YXIgeEF4aXNPcHRzID0ge1xuICAgICAgICAgICAgdHlwZTogJ2NhdGVnb3J5JyxcbiAgICAgICAgICAgIGRhdGE6IHJvd3MubWFwKGZ1bmN0aW9uIChyb3cpIHsgcmV0dXJuIHhlX3V0aWxzXzFbXCJkZWZhdWx0XCJdLmdldChyb3csIGNhdGVnb3J5Q29sdW1uLnByb3BlcnR5KTsgfSlcbiAgICAgICAgfTtcbiAgICAgICAgc2VyaWVDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikge1xuICAgICAgICAgICAgbGVnZW5kT3B0cy5kYXRhLnB1c2goY29sdW1uLnRpdGxlKTtcbiAgICAgICAgICAgIHNlcmllc09wdHMucHVzaCh7XG4gICAgICAgICAgICAgICAgbmFtZTogY29sdW1uLnRpdGxlLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdiYXInLFxuICAgICAgICAgICAgICAgIGRhdGE6IHJvd3MubWFwKGZ1bmN0aW9uIChyb3cpIHsgcmV0dXJuIHhlX3V0aWxzXzFbXCJkZWZhdWx0XCJdLmdldChyb3csIGNvbHVtbi5wcm9wZXJ0eSk7IH0pXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBvcHRpb24gPSB7XG4gICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgdHJpZ2dlcjogJ2F4aXMnLFxuICAgICAgICAgICAgICAgIGF4aXNQb2ludGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzaGFkb3cnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxlZ2VuZDogbGVnZW5kT3B0cyxcbiAgICAgICAgICAgIHhBeGlzOiB4QXhpc09wdHMsXG4gICAgICAgICAgICB5QXhpczoge1xuICAgICAgICAgICAgICAgIHR5cGU6ICd2YWx1ZSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXJpZXM6IHNlcmllc09wdHNcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIG9wdGlvbjtcbiAgICB9KSxcbiAgICBDSEFSVF9MSU5FOiBjcmVhdGVDaGFydE1vZGFsKGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyICR0YWJsZSA9IHBhcmFtcy4kdGFibGUsIG1lbnUgPSBwYXJhbXMubWVudTtcbiAgICAgICAgdmFyIF9hID0gJHRhYmxlLmdldE1vdXNlQ2hlY2tlZHMoKSwgcm93cyA9IF9hLnJvd3MsIGNvbHVtbnMgPSBfYS5jb2x1bW5zO1xuICAgICAgICB2YXIgX2IgPSBtZW51LnBhcmFtcywgY2hhcnRQYXJhbXMgPSBfYiA9PT0gdm9pZCAwID8ge30gOiBfYjtcbiAgICAgICAgdmFyIGNhdGVnb3J5ID0gY2hhcnRQYXJhbXMuY2F0ZWdvcnk7XG4gICAgICAgIHZhciBjYXRlZ29yeUNvbHVtbiA9ICR0YWJsZS5nZXRDb2x1bW5CeUZpZWxkKGNhdGVnb3J5IHx8IGNvbHVtbnNbMF0ucHJvcGVydHkpO1xuICAgICAgICB2YXIgc2VyaWVDb2x1bW5zID0gY29sdW1ucy5maWx0ZXIoZnVuY3Rpb24gKGNvbHVtbikgeyByZXR1cm4gY29sdW1uLnByb3BlcnR5ICE9PSBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eTsgfSk7XG4gICAgICAgIHZhciBsZWdlbmRPcHRzID0ge1xuICAgICAgICAgICAgZGF0YTogW11cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHNlcmllc09wdHMgPSBbXTtcbiAgICAgICAgdmFyIHhBeGlzT3B0cyA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdjYXRlZ29yeScsXG4gICAgICAgICAgICBkYXRhOiByb3dzLm1hcChmdW5jdGlvbiAocm93KSB7IHJldHVybiB4ZV91dGlsc18xW1wiZGVmYXVsdFwiXS5nZXQocm93LCBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eSk7IH0pXG4gICAgICAgIH07XG4gICAgICAgIHNlcmllQ29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcbiAgICAgICAgICAgIGxlZ2VuZE9wdHMuZGF0YS5wdXNoKGNvbHVtbi50aXRsZSk7XG4gICAgICAgICAgICBzZXJpZXNPcHRzLnB1c2goe1xuICAgICAgICAgICAgICAgIG5hbWU6IGNvbHVtbi50aXRsZSxcbiAgICAgICAgICAgICAgICB0eXBlOiAnbGluZScsXG4gICAgICAgICAgICAgICAgZGF0YTogcm93cy5tYXAoZnVuY3Rpb24gKHJvdykgeyByZXR1cm4geGVfdXRpbHNfMVtcImRlZmF1bHRcIl0uZ2V0KHJvdywgY29sdW1uLnByb3BlcnR5KTsgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIG9wdGlvbiA9IHtcbiAgICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgICAgICB0cmlnZ2VyOiAnYXhpcydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsZWdlbmQ6IGxlZ2VuZE9wdHMsXG4gICAgICAgICAgICB0b29sYm94OiB7XG4gICAgICAgICAgICAgICAgZmVhdHVyZToge1xuICAgICAgICAgICAgICAgICAgICBzYXZlQXNJbWFnZToge31cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeEF4aXM6IHhBeGlzT3B0cyxcbiAgICAgICAgICAgIHlBeGlzOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3ZhbHVlJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlcmllczogc2VyaWVzT3B0c1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gb3B0aW9uO1xuICAgIH0pLFxuICAgIENIQVJUX1BJRTogY3JlYXRlQ2hhcnRNb2RhbChmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBwYXJhbXMuJHRhYmxlLCBtZW51ID0gcGFyYW1zLm1lbnU7XG4gICAgICAgIHZhciBfYSA9ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKCksIHJvd3MgPSBfYS5yb3dzLCBjb2x1bW5zID0gX2EuY29sdW1ucztcbiAgICAgICAgdmFyIF9iID0gbWVudS5wYXJhbXMsIGNoYXJ0UGFyYW1zID0gX2IgPT09IHZvaWQgMCA/IHt9IDogX2I7XG4gICAgICAgIHZhciBjYXRlZ29yeSA9IGNoYXJ0UGFyYW1zLmNhdGVnb3J5O1xuICAgICAgICB2YXIgY2F0ZWdvcnlDb2x1bW4gPSAkdGFibGUuZ2V0Q29sdW1uQnlGaWVsZChjYXRlZ29yeSB8fCBjb2x1bW5zWzBdLnByb3BlcnR5KTtcbiAgICAgICAgdmFyIHNlcmllQ29sdW1ucyA9IGNvbHVtbnMuZmlsdGVyKGZ1bmN0aW9uIChjb2x1bW4pIHsgcmV0dXJuIGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHk7IH0pO1xuICAgICAgICB2YXIgc2VyaWVDb2x1bW4gPSBzZXJpZUNvbHVtbnNbMF07XG4gICAgICAgIHZhciBsZWdlbmREYXRhID0gcm93cy5tYXAoZnVuY3Rpb24gKHJvdykgeyByZXR1cm4geGVfdXRpbHNfMVtcImRlZmF1bHRcIl0uZ2V0KHJvdywgY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpOyB9KTtcbiAgICAgICAgdmFyIHNlcmllc0RhdGEgPSBbXTtcbiAgICAgICAgcm93cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgIHNlcmllc0RhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgbmFtZTogeGVfdXRpbHNfMVtcImRlZmF1bHRcIl0uZ2V0KHJvdywgY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB4ZV91dGlsc18xW1wiZGVmYXVsdFwiXS5nZXQocm93LCBzZXJpZUNvbHVtbi5wcm9wZXJ0eSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIG9wdGlvbiA9IHtcbiAgICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgICAgICB0cmlnZ2VyOiAnaXRlbScsXG4gICAgICAgICAgICAgICAgZm9ybWF0dGVyOiAne2F9IDxici8+e2J9IDoge2N9ICh7ZH0lKSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsZWdlbmQ6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnc2Nyb2xsJyxcbiAgICAgICAgICAgICAgICBvcmllbnQ6ICd2ZXJ0aWNhbCcsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDEwLFxuICAgICAgICAgICAgICAgIHRvcDogMjAsXG4gICAgICAgICAgICAgICAgYm90dG9tOiAyMCxcbiAgICAgICAgICAgICAgICBkYXRhOiBsZWdlbmREYXRhXG4gICAgICAgICAgICAgICAgLy8gc2VsZWN0ZWQ6IGRhdGEuc2VsZWN0ZWRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXJpZXM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHNlcmllQ29sdW1uLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAncGllJyxcbiAgICAgICAgICAgICAgICAgICAgcmFkaXVzOiAnNTAlJyxcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyOiBbJzQwJScsICc1MCUnXSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogc2VyaWVzRGF0YVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIG9wdGlvbjtcbiAgICB9KVxufTtcbmZ1bmN0aW9uIGNoZWNrUHJpdmlsZWdlKGl0ZW0sIHBhcmFtcykge1xuICAgIHZhciAkdGFibGUgPSBwYXJhbXMuJHRhYmxlO1xuICAgIHZhciBjb2RlID0gaXRlbS5jb2RlLCBfYSA9IGl0ZW0ucGFyYW1zLCBjaGFydFBhcmFtcyA9IF9hID09PSB2b2lkIDAgPyB7fSA6IF9hO1xuICAgIHN3aXRjaCAoY29kZSkge1xuICAgICAgICBjYXNlICdDSEFSVF9CQVJfWF9BWElTJzpcbiAgICAgICAgY2FzZSAnQ0hBUlRfQkFSX1lfQVhJUyc6XG4gICAgICAgIGNhc2UgJ0NIQVJUX0xJTkUnOlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciBfYiA9ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKCksIHJvd3MgPSBfYi5yb3dzLCBjb2x1bW5zID0gX2IuY29sdW1ucztcbiAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlfMSA9IGNoYXJ0UGFyYW1zLmNhdGVnb3J5O1xuICAgICAgICAgICAgICAgIGlmIChjYXRlZ29yeV8xKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzZXJpZUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcihmdW5jdGlvbiAoY29sdW1uKSB7IHJldHVybiBjb2x1bW4ucHJvcGVydHkgIT09IGNhdGVnb3J5XzE7IH0pO1xuICAgICAgICAgICAgICAgICAgICBpdGVtLmRpc2FibGVkID0gIXJvd3MubGVuZ3RoIHx8IHNlcmllQ29sdW1ucy5sZW5ndGggPCAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5kaXNhYmxlZCA9ICFyb3dzLmxlbmd0aCB8fCBjb2x1bW5zLmxlbmd0aCA8IDI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ0NIQVJUX1BJRSc6XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIF9jID0gJHRhYmxlLmdldE1vdXNlQ2hlY2tlZHMoKSwgcm93cyA9IF9jLnJvd3MsIGNvbHVtbnMgPSBfYy5jb2x1bW5zO1xuICAgICAgICAgICAgICAgIHZhciBjYXRlZ29yeV8yID0gY2hhcnRQYXJhbXMuY2F0ZWdvcnk7XG4gICAgICAgICAgICAgICAgaWYgKGNhdGVnb3J5XzIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlcmllQ29sdW1ucyA9IGNvbHVtbnMuZmlsdGVyKGZ1bmN0aW9uIChjb2x1bW4pIHsgcmV0dXJuIGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnlfMjsgfSk7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uZGlzYWJsZWQgPSAhcm93cy5sZW5ndGggfHwgc2VyaWVDb2x1bW5zLmxlbmd0aCAhPT0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uZGlzYWJsZWQgPSAhcm93cy5sZW5ndGggfHwgY29sdW1ucy5sZW5ndGggIT09IDI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxufVxuZnVuY3Rpb24gaGFuZGxlUHJpdmlsZWdlRXZlbnQocGFyYW1zKSB7XG4gICAgcGFyYW1zLm9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAobGlzdCkge1xuICAgICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIGNoZWNrUHJpdmlsZWdlKGl0ZW0sIHBhcmFtcyk7XG4gICAgICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIGl0ZW0uY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tQcml2aWxlZ2UoY2hpbGQsIHBhcmFtcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuLyoqXG4gKiDln7rkuo4gdnhlLXRhYmxlIOihqOagvOeahOWbvuihqOa4suafk+aPkuS7tlxuICovXG5leHBvcnRzLlZYRVRhYmxlUGx1Z2luQ2hhcnRzID0ge1xuICAgIGluc3RhbGw6IGZ1bmN0aW9uICh4dGFibGUpIHtcbiAgICAgICAgdmFyIGludGVyY2VwdG9yID0geHRhYmxlLmludGVyY2VwdG9yLCBtZW51cyA9IHh0YWJsZS5tZW51cywgX21vZGFsID0geHRhYmxlLl9tb2RhbDtcbiAgICAgICAgaWYgKCFfbW9kYWwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW3Z4ZS10YWJsZS1wbHVnaW4tY2hhcnRzXSByZXF1aXJlIE1vZGFsIG1vZHVsZS4nKTtcbiAgICAgICAgfVxuICAgICAgICBpbnRlcmNlcHRvci5hZGQoJ2V2ZW50LnNob3dfbWVudScsIGhhbmRsZVByaXZpbGVnZUV2ZW50KTtcbiAgICAgICAgbWVudXMubWl4aW4obWVudU1hcCk7XG4gICAgfVxufTtcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVlhFVGFibGUpIHtcbiAgICB3aW5kb3cuVlhFVGFibGUudXNlKGV4cG9ydHMuVlhFVGFibGVQbHVnaW5DaGFydHMpO1xufVxuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBleHBvcnRzLlZYRVRhYmxlUGx1Z2luQ2hhcnRzO1xuIiwiaW1wb3J0IFhFVXRpbHMgZnJvbSAneGUtdXRpbHMvbWV0aG9kcy94ZS11dGlscydcclxuaW1wb3J0ICogYXMgZWNoYXJ0cyBmcm9tICdlY2hhcnRzL2xpYi9lY2hhcnRzJ1xyXG5pbXBvcnQgeyBWWEVUYWJsZSB9IGZyb20gJ3Z4ZS10YWJsZSdcclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUNoYXJ0TW9kYWwgKGdldE9wdGlvbnM6IGFueSkge1xyXG4gIHJldHVybiBmdW5jdGlvbiAocGFyYW1zOiBhbnkpIHtcclxuICAgIGxldCB7IG1lbnUgfSA9IHBhcmFtc1xyXG4gICAgdGhpcy4kWE1vZGFsKHtcclxuICAgICAgcmVzaXplOiB0cnVlLFxyXG4gICAgICBtYXNrOiBmYWxzZSxcclxuICAgICAgbG9ja1ZpZXc6IGZhbHNlLFxyXG4gICAgICBzaG93Rm9vdGVyOiBmYWxzZSxcclxuICAgICAgd2lkdGg6IDYwMCxcclxuICAgICAgaGVpZ2h0OiA0MDAsXHJcbiAgICAgIHRpdGxlOiBtZW51Lm5hbWUsXHJcbiAgICAgIHNsb3RzOiB7XHJcbiAgICAgICAgZGVmYXVsdCAocGFyYW1zOiBhbnksIGg6IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICBoKCdkaXYnLCB7XHJcbiAgICAgICAgICAgICAgY2xhc3M6ICd2eGUtY2hhcnQtLXdyYXBwZXInXHJcbiAgICAgICAgICAgIH0sIFtcclxuICAgICAgICAgICAgICBoKCdkaXYnLCB7XHJcbiAgICAgICAgICAgICAgICBjbGFzczogJ3Z4ZS1jaGFydC0tcGFuZWwnXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgXSlcclxuICAgICAgICAgIF1cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGV2ZW50czoge1xyXG4gICAgICAgIHNob3cgKCkge1xyXG4gICAgICAgICAgY29uc3QgJGNoYXJ0ID0gZWNoYXJ0cy5pbml0KHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoJy52eGUtY2hhcnQtLXdyYXBwZXInKSlcclxuICAgICAgICAgICRjaGFydC5zZXRPcHRpb24oZ2V0T3B0aW9ucyhwYXJhbXMpKVxyXG4gICAgICAgICAgdGhpcy4kY2hhcnQgPSAkY2hhcnRcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNsb3NlICgpIHtcclxuICAgICAgICAgIC8vIOaXp+eJiOacrO+8jOWNs+WwhuW6n+W8g1xyXG4gICAgICAgICAgdGhpcy4kY2hhcnQuZGlzcG9zZSgpXHJcbiAgICAgICAgICB0aGlzLiRjaGFydCA9IG51bGxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGhpZGUgKCkge1xyXG4gICAgICAgICAgdGhpcy4kY2hhcnQuZGlzcG9zZSgpXHJcbiAgICAgICAgICB0aGlzLiRjaGFydCA9IG51bGxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHpvb20gKCkge1xyXG4gICAgICAgICAgdGhpcy4kY2hhcnQucmVzaXplKClcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG59XHJcblxyXG5pbnRlcmZhY2UgbGVnZW5kT3B0cyB7XHJcbiAgZGF0YTogQXJyYXk8YW55PjtcclxufVxyXG5cclxuY29uc3QgbWVudU1hcCA9IHtcclxuICBDSEFSVF9CQVJfWF9BWElTOiBjcmVhdGVDaGFydE1vZGFsKChwYXJhbXM6IGFueSkgPT4ge1xyXG4gICAgY29uc3QgeyAkdGFibGUsIG1lbnUgfSA9IHBhcmFtc1xyXG4gICAgY29uc3QgeyByb3dzLCBjb2x1bW5zIH0gPSAkdGFibGUuZ2V0TW91c2VDaGVja2VkcygpXHJcbiAgICBjb25zdCB7IHBhcmFtczogY2hhcnRQYXJhbXMgPSB7fSB9ID0gbWVudVxyXG4gICAgY29uc3QgeyBjYXRlZ29yeSB9ID0gY2hhcnRQYXJhbXNcclxuICAgIGxldCBjYXRlZ29yeUNvbHVtbiA9ICR0YWJsZS5nZXRDb2x1bW5CeUZpZWxkKGNhdGVnb3J5IHx8IGNvbHVtbnNbMF0ucHJvcGVydHkpXHJcbiAgICBsZXQgc2VyaWVDb2x1bW5zID0gY29sdW1ucy5maWx0ZXIoKGNvbHVtbjogYW55KSA9PiBjb2x1bW4ucHJvcGVydHkgIT09IGNhdGVnb3J5Q29sdW1uLnByb3BlcnR5KVxyXG4gICAgbGV0IGxlZ2VuZE9wdHM6IGxlZ2VuZE9wdHMgPSB7XHJcbiAgICAgIGRhdGE6IFtdXHJcbiAgICB9XHJcbiAgICBsZXQgc2VyaWVzT3B0czogQXJyYXk8YW55PiA9IFtdXHJcbiAgICBsZXQgeEF4aXNPcHRzID0ge1xyXG4gICAgICB0eXBlOiAnY2F0ZWdvcnknLFxyXG4gICAgICBkYXRhOiByb3dzLm1hcCgocm93OiBhbnkpID0+IFhFVXRpbHMuZ2V0KHJvdywgY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpKVxyXG4gICAgfVxyXG4gICAgc2VyaWVDb2x1bW5zLmZvckVhY2goKGNvbHVtbjogYW55KSA9PiB7XHJcbiAgICAgIGxlZ2VuZE9wdHMuZGF0YS5wdXNoKGNvbHVtbi50aXRsZSlcclxuICAgICAgc2VyaWVzT3B0cy5wdXNoKHtcclxuICAgICAgICBuYW1lOiBjb2x1bW4udGl0bGUsXHJcbiAgICAgICAgdHlwZTogJ2JhcicsXHJcbiAgICAgICAgZGF0YTogcm93cy5tYXAoKHJvdzogYW55KSA9PiBYRVV0aWxzLmdldChyb3csIGNvbHVtbi5wcm9wZXJ0eSkpXHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gICAgY29uc3Qgb3B0aW9uID0ge1xyXG4gICAgICB0b29sdGlwOiB7XHJcbiAgICAgICAgdHJpZ2dlcjogJ2F4aXMnLFxyXG4gICAgICAgIGF4aXNQb2ludGVyOiB7XHJcbiAgICAgICAgICB0eXBlOiAnc2hhZG93J1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgbGVnZW5kOiBsZWdlbmRPcHRzLFxyXG4gICAgICB4QXhpczogeEF4aXNPcHRzLFxyXG4gICAgICB5QXhpczoge1xyXG4gICAgICAgIHR5cGU6ICd2YWx1ZSdcclxuICAgICAgfSxcclxuICAgICAgc2VyaWVzOiBzZXJpZXNPcHRzXHJcbiAgICB9XHJcbiAgICByZXR1cm4gb3B0aW9uXHJcbiAgfSksXHJcbiAgQ0hBUlRfQkFSX1lfQVhJUzogY3JlYXRlQ2hhcnRNb2RhbCgocGFyYW1zOiBhbnkpID0+IHtcclxuICAgIGNvbnN0IHsgJHRhYmxlLCBtZW51IH0gPSBwYXJhbXNcclxuICAgIGNvbnN0IHsgcm93cywgY29sdW1ucyB9ID0gJHRhYmxlLmdldE1vdXNlQ2hlY2tlZHMoKVxyXG4gICAgY29uc3QgeyBwYXJhbXM6IGNoYXJ0UGFyYW1zID0ge30gfSA9IG1lbnVcclxuICAgIGNvbnN0IHsgY2F0ZWdvcnkgfSA9IGNoYXJ0UGFyYW1zXHJcbiAgICBsZXQgY2F0ZWdvcnlDb2x1bW4gPSAkdGFibGUuZ2V0Q29sdW1uQnlGaWVsZChjYXRlZ29yeSB8fCBjb2x1bW5zWzBdLnByb3BlcnR5KVxyXG4gICAgbGV0IHNlcmllQ29sdW1ucyA9IGNvbHVtbnMuZmlsdGVyKChjb2x1bW46IGFueSkgPT4gY29sdW1uLnByb3BlcnR5ICE9PSBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eSlcclxuICAgIGxldCBsZWdlbmRPcHRzOiBsZWdlbmRPcHRzID0ge1xyXG4gICAgICBkYXRhOiBbXVxyXG4gICAgfVxyXG4gICAgbGV0IHNlcmllc09wdHM6IEFycmF5PGFueT4gPSBbXVxyXG4gICAgbGV0IHhBeGlzT3B0cyA9IHtcclxuICAgICAgdHlwZTogJ2NhdGVnb3J5JyxcclxuICAgICAgZGF0YTogcm93cy5tYXAoKHJvdzogYW55KSA9PiBYRVV0aWxzLmdldChyb3csIGNhdGVnb3J5Q29sdW1uLnByb3BlcnR5KSlcclxuICAgIH1cclxuICAgIHNlcmllQ29sdW1ucy5mb3JFYWNoKChjb2x1bW46IGFueSkgPT4ge1xyXG4gICAgICBsZWdlbmRPcHRzLmRhdGEucHVzaChjb2x1bW4udGl0bGUpXHJcbiAgICAgIHNlcmllc09wdHMucHVzaCh7XHJcbiAgICAgICAgbmFtZTogY29sdW1uLnRpdGxlLFxyXG4gICAgICAgIHR5cGU6ICdiYXInLFxyXG4gICAgICAgIGRhdGE6IHJvd3MubWFwKChyb3c6IGFueSkgPT4gWEVVdGlscy5nZXQocm93LCBjb2x1bW4ucHJvcGVydHkpKVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICAgIGNvbnN0IG9wdGlvbiA9IHtcclxuICAgICAgdG9vbHRpcDoge1xyXG4gICAgICAgIHRyaWdnZXI6ICdheGlzJyxcclxuICAgICAgICBheGlzUG9pbnRlcjoge1xyXG4gICAgICAgICAgdHlwZTogJ3NoYWRvdydcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGxlZ2VuZDogbGVnZW5kT3B0cyxcclxuICAgICAgeEF4aXM6IHhBeGlzT3B0cyxcclxuICAgICAgeUF4aXM6IHtcclxuICAgICAgICB0eXBlOiAndmFsdWUnXHJcbiAgICAgIH0sXHJcbiAgICAgIHNlcmllczogc2VyaWVzT3B0c1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9wdGlvblxyXG4gIH0pLFxyXG4gIENIQVJUX0xJTkU6IGNyZWF0ZUNoYXJ0TW9kYWwoKHBhcmFtczogYW55KSA9PiB7XHJcbiAgICBjb25zdCB7ICR0YWJsZSwgbWVudSB9ID0gcGFyYW1zXHJcbiAgICBjb25zdCB7IHJvd3MsIGNvbHVtbnMgfSA9ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKClcclxuICAgIGNvbnN0IHsgcGFyYW1zOiBjaGFydFBhcmFtcyA9IHt9IH0gPSBtZW51XHJcbiAgICBjb25zdCB7IGNhdGVnb3J5IH0gPSBjaGFydFBhcmFtc1xyXG4gICAgbGV0IGNhdGVnb3J5Q29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5RmllbGQoY2F0ZWdvcnkgfHwgY29sdW1uc1swXS5wcm9wZXJ0eSlcclxuICAgIGxldCBzZXJpZUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpXHJcbiAgICBsZXQgbGVnZW5kT3B0czogbGVnZW5kT3B0cyA9IHtcclxuICAgICAgZGF0YTogW11cclxuICAgIH1cclxuICAgIGxldCBzZXJpZXNPcHRzOiBBcnJheTxhbnk+ID0gW11cclxuICAgIGxldCB4QXhpc09wdHMgPSB7XHJcbiAgICAgIHR5cGU6ICdjYXRlZ29yeScsXHJcbiAgICAgIGRhdGE6IHJvd3MubWFwKChyb3c6IGFueSkgPT4gWEVVdGlscy5nZXQocm93LCBjYXRlZ29yeUNvbHVtbi5wcm9wZXJ0eSkpXHJcbiAgICB9XHJcbiAgICBzZXJpZUNvbHVtbnMuZm9yRWFjaCgoY29sdW1uOiBhbnkpID0+IHtcclxuICAgICAgbGVnZW5kT3B0cy5kYXRhLnB1c2goY29sdW1uLnRpdGxlKVxyXG4gICAgICBzZXJpZXNPcHRzLnB1c2goe1xyXG4gICAgICAgIG5hbWU6IGNvbHVtbi50aXRsZSxcclxuICAgICAgICB0eXBlOiAnbGluZScsXHJcbiAgICAgICAgZGF0YTogcm93cy5tYXAoKHJvdzogYW55KSA9PiBYRVV0aWxzLmdldChyb3csIGNvbHVtbi5wcm9wZXJ0eSkpXHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gICAgbGV0IG9wdGlvbiA9IHtcclxuICAgICAgdG9vbHRpcDoge1xyXG4gICAgICAgIHRyaWdnZXI6ICdheGlzJ1xyXG4gICAgICB9LFxyXG4gICAgICBsZWdlbmQ6IGxlZ2VuZE9wdHMsXHJcbiAgICAgIHRvb2xib3g6IHtcclxuICAgICAgICBmZWF0dXJlOiB7XHJcbiAgICAgICAgICBzYXZlQXNJbWFnZToge31cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHhBeGlzOiB4QXhpc09wdHMsXHJcbiAgICAgIHlBeGlzOiB7XHJcbiAgICAgICAgdHlwZTogJ3ZhbHVlJ1xyXG4gICAgICB9LFxyXG4gICAgICBzZXJpZXM6IHNlcmllc09wdHNcclxuICAgIH1cclxuICAgIHJldHVybiBvcHRpb25cclxuICB9KSxcclxuICBDSEFSVF9QSUU6IGNyZWF0ZUNoYXJ0TW9kYWwoKHBhcmFtczogYW55KSA9PiB7XHJcbiAgICBjb25zdCB7ICR0YWJsZSwgbWVudSB9ID0gcGFyYW1zXHJcbiAgICBjb25zdCB7IHJvd3MsIGNvbHVtbnMgfSA9ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKClcclxuICAgIGNvbnN0IHsgcGFyYW1zOiBjaGFydFBhcmFtcyA9IHt9IH0gPSBtZW51XHJcbiAgICBjb25zdCB7IGNhdGVnb3J5IH0gPSBjaGFydFBhcmFtc1xyXG4gICAgbGV0IGNhdGVnb3J5Q29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5RmllbGQoY2F0ZWdvcnkgfHwgY29sdW1uc1swXS5wcm9wZXJ0eSlcclxuICAgIGxldCBzZXJpZUNvbHVtbnMgPSBjb2x1bW5zLmZpbHRlcigoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5wcm9wZXJ0eSAhPT0gY2F0ZWdvcnlDb2x1bW4ucHJvcGVydHkpXHJcbiAgICBsZXQgc2VyaWVDb2x1bW4gPSBzZXJpZUNvbHVtbnNbMF1cclxuICAgIGxldCBsZWdlbmREYXRhID0gcm93cy5tYXAoKHJvdzogYW55KSA9PiBYRVV0aWxzLmdldChyb3csIGNhdGVnb3J5Q29sdW1uLnByb3BlcnR5KSlcclxuICAgIGxldCBzZXJpZXNEYXRhOiBBcnJheTxhbnk+ID0gW11cclxuICAgIHJvd3MuZm9yRWFjaCgocm93OiBhbnkpID0+IHtcclxuICAgICAgc2VyaWVzRGF0YS5wdXNoKHtcclxuICAgICAgICBuYW1lOiBYRVV0aWxzLmdldChyb3csIGNhdGVnb3J5Q29sdW1uLnByb3BlcnR5KSxcclxuICAgICAgICB2YWx1ZTogWEVVdGlscy5nZXQocm93LCBzZXJpZUNvbHVtbi5wcm9wZXJ0eSlcclxuICAgICAgfSlcclxuICAgIH0pXHJcbiAgICBsZXQgb3B0aW9uID0ge1xyXG4gICAgICB0b29sdGlwOiB7XHJcbiAgICAgICAgdHJpZ2dlcjogJ2l0ZW0nLFxyXG4gICAgICAgIGZvcm1hdHRlcjogJ3thfSA8YnIvPntifSA6IHtjfSAoe2R9JSknXHJcbiAgICAgIH0sXHJcbiAgICAgIGxlZ2VuZDoge1xyXG4gICAgICAgIHR5cGU6ICdzY3JvbGwnLFxyXG4gICAgICAgIG9yaWVudDogJ3ZlcnRpY2FsJyxcclxuICAgICAgICByaWdodDogMTAsXHJcbiAgICAgICAgdG9wOiAyMCxcclxuICAgICAgICBib3R0b206IDIwLFxyXG4gICAgICAgIGRhdGE6IGxlZ2VuZERhdGFcclxuICAgICAgICAvLyBzZWxlY3RlZDogZGF0YS5zZWxlY3RlZFxyXG4gICAgICB9LFxyXG4gICAgICBzZXJpZXM6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBuYW1lOiBzZXJpZUNvbHVtbi50aXRsZSxcclxuICAgICAgICAgIHR5cGU6ICdwaWUnLFxyXG4gICAgICAgICAgcmFkaXVzOiAnNTAlJyxcclxuICAgICAgICAgIGNlbnRlcjogWyc0MCUnLCAnNTAlJ10sXHJcbiAgICAgICAgICBkYXRhOiBzZXJpZXNEYXRhXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgICB9XHJcbiAgICByZXR1cm4gb3B0aW9uXHJcbiAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gY2hlY2tQcml2aWxlZ2UgKGl0ZW06IGFueSwgcGFyYW1zOiBhbnkpIHtcclxuICBjb25zdCB7ICR0YWJsZSB9ID0gcGFyYW1zXHJcbiAgY29uc3QgeyBjb2RlLCBwYXJhbXM6IGNoYXJ0UGFyYW1zID0ge30gfSA9IGl0ZW1cclxuICBzd2l0Y2ggKGNvZGUpIHtcclxuICAgIGNhc2UgJ0NIQVJUX0JBUl9YX0FYSVMnOlxyXG4gICAgY2FzZSAnQ0hBUlRfQkFSX1lfQVhJUyc6XHJcbiAgICBjYXNlICdDSEFSVF9MSU5FJzoge1xyXG4gICAgICBjb25zdCB7IHJvd3MsIGNvbHVtbnMgfSA9ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKClcclxuICAgICAgY29uc3QgeyBjYXRlZ29yeSB9ID0gY2hhcnRQYXJhbXNcclxuICAgICAgaWYgKGNhdGVnb3J5KSB7XHJcbiAgICAgICAgbGV0IHNlcmllQ29sdW1ucyA9IGNvbHVtbnMuZmlsdGVyKChjb2x1bW46IGFueSkgPT4gY29sdW1uLnByb3BlcnR5ICE9PSBjYXRlZ29yeSlcclxuICAgICAgICBpdGVtLmRpc2FibGVkID0gIXJvd3MubGVuZ3RoIHx8IHNlcmllQ29sdW1ucy5sZW5ndGggPCAxXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaXRlbS5kaXNhYmxlZCA9ICFyb3dzLmxlbmd0aCB8fCBjb2x1bW5zLmxlbmd0aCA8IDJcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgICBicmVha1xyXG4gICAgY2FzZSAnQ0hBUlRfUElFJzoge1xyXG4gICAgICBjb25zdCB7IHJvd3MsIGNvbHVtbnMgfSA9ICR0YWJsZS5nZXRNb3VzZUNoZWNrZWRzKClcclxuICAgICAgY29uc3QgeyBjYXRlZ29yeSB9ID0gY2hhcnRQYXJhbXNcclxuICAgICAgaWYgKGNhdGVnb3J5KSB7XHJcbiAgICAgICAgbGV0IHNlcmllQ29sdW1ucyA9IGNvbHVtbnMuZmlsdGVyKChjb2x1bW46IGFueSkgPT4gY29sdW1uLnByb3BlcnR5ICE9PSBjYXRlZ29yeSlcclxuICAgICAgICBpdGVtLmRpc2FibGVkID0gIXJvd3MubGVuZ3RoIHx8IHNlcmllQ29sdW1ucy5sZW5ndGggIT09IDFcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpdGVtLmRpc2FibGVkID0gIXJvd3MubGVuZ3RoIHx8IGNvbHVtbnMubGVuZ3RoICE9PSAyXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgICAgYnJlYWtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZVByaXZpbGVnZUV2ZW50IChwYXJhbXM6IGFueSkge1xyXG4gIHBhcmFtcy5vcHRpb25zLmZvckVhY2goKGxpc3Q6IEFycmF5PGFueT4pID0+IHtcclxuICAgIGxpc3QuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgIGNoZWNrUHJpdmlsZWdlKGl0ZW0sIHBhcmFtcylcclxuICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4pIHtcclxuICAgICAgICBpdGVtLmNoaWxkcmVuLmZvckVhY2goKGNoaWxkOiBhbnkpID0+IHtcclxuICAgICAgICAgIGNoZWNrUHJpdmlsZWdlKGNoaWxkLCBwYXJhbXMpXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICog5Z+65LqOIHZ4ZS10YWJsZSDooajmoLznmoTlm77ooajmuLLmn5Pmj5Lku7ZcclxuICovXHJcbmV4cG9ydCBjb25zdCBWWEVUYWJsZVBsdWdpbkNoYXJ0cyA9IHtcclxuICBpbnN0YWxsICh4dGFibGU6IHR5cGVvZiBWWEVUYWJsZSkge1xyXG4gICAgbGV0IHsgaW50ZXJjZXB0b3IsIG1lbnVzLCBfbW9kYWwgfSA9IHh0YWJsZVxyXG4gICAgaWYgKCFfbW9kYWwpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdbdnhlLXRhYmxlLXBsdWdpbi1jaGFydHNdIHJlcXVpcmUgTW9kYWwgbW9kdWxlLicpXHJcbiAgICB9XHJcbiAgICBpbnRlcmNlcHRvci5hZGQoJ2V2ZW50LnNob3dfbWVudScsIGhhbmRsZVByaXZpbGVnZUV2ZW50KVxyXG4gICAgbWVudXMubWl4aW4obWVudU1hcClcclxuICB9XHJcbn1cclxuXHJcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVlhFVGFibGUpIHtcclxuICB3aW5kb3cuVlhFVGFibGUudXNlKFZYRVRhYmxlUGx1Z2luQ2hhcnRzKVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBWWEVUYWJsZVBsdWdpbkNoYXJ0c1xyXG4iXX0=
